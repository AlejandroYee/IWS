/*******************************************************************************
 * jquery.ui-contextmenu.js plugin.
 *
 * jQuery plugin that provides a context menu (based on the jQueryUI menu widget).
 *
 * @see https://github.com/mar10/jquery-ui-contextmenu
 *
 * Copyright (c) 2013, Martin Wendt (http://wwWendt.de). Licensed MIT.
 */

 (function(b,m,g,k){function h(a){return a&&a.match(/^#/)?a.substring(1):a||""}var l="onselectstart"in g.createElement("div");b.widget("moogle.contextmenu",{version:"1.3.0-1",options:{delegate:null,hide:{effect:"fadeOut",duration:"fast"},ignoreParentSelect:!0,menu:null,position:null,preventSelect:!1,show:{effect:"slideDown",duration:"fast"},taphold:!1,beforeOpen:b.noop,blur:b.noop,close:b.noop,create:b.noop,createMenu:b.noop,focus:b.noop,open:b.noop,select:b.noop},_create:function(){var a,c=this.options;
this.$menu=this.$headStyle=null;this.menuIsTemp=!1;this.currentTarget=null;if(c.preventSelect){a=(b(this.element).is(g)?b("body"):this.element).uniqueId().attr("id");a="#"+a+" "+c.delegate+" { -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }";this.$headStyle=b("<style class='moogle-contextmenu-style' />").prop("type","text/css").appendTo("head");try{this.$headStyle.html(a)}catch(d){this.$headStyle[0].styleSheet.cssText=a}l&&this.element.delegate(c.delegate,
"selectstart"+this.eventNamespace,function(a){a.preventDefault()})}this._createUiMenu(c.menu);a="contextmenu"+this.eventNamespace;c.taphold&&(a+=" taphold"+this.eventNamespace);this.element.delegate(c.delegate,a,b.proxy(this._openMenu,this))},_destroy:function(){this.element.undelegate(this.eventNamespace);this._createUiMenu(null);this.$headStyle&&(this.$headStyle.remove(),this.$headStyle=null)},_createUiMenu:function(a){this.isOpen()&&this._closeMenu(!0);this.menuIsTemp?this.$menu.remove():this.$menu&&
this.$menu.menu("destroy").hide();this.$menu=null;this.menuIsTemp=!1;a&&(b.isArray(a)?(this.$menu=b.moogle.contextmenu.createMenuMarkup(a),this.menuIsTemp=!0):this.$menu="string"===typeof a?b(a):a,this.$menu.hide().menu({blur:b.proxy(this.options.blur,this),create:b.proxy(this.options.createMenu,this),focus:b.proxy(this.options.focus,this),select:b.proxy(function(a,d){var e;e=0<d.item.has(">a[aria-haspopup='true']").length;var f=d.item.find(">a"),g=f.data("actionHandler");d.cmd=h(f.attr("href"));
d.target=b(this.currentTarget);e&&this.options.ignoreParentSelect||(e=this._trigger.call(this,"select",a,d),g&&(e=g.call(this,a,d)),!1!==e&&this._closeMenu.call(this),a.preventDefault())},this)}))},_openMenu:function(a){var c=this.options.position,d=this,e={menu:this.$menu,target:b(a.target),extraData:a.extraData};this.currentTarget=a.target;a.preventDefault();if(!1===this._trigger("beforeOpen",a,e))return this.currentTarget=null,!1;e.menu=this.$menu;b(g).bind("keydown"+this.eventNamespace,function(a){a.which===
b.ui.keyCode.ESCAPE&&d._closeMenu()}).bind("mousedown"+this.eventNamespace+" touchstart"+this.eventNamespace,function(a){b(a.target).closest(".ui-menu-item").length||d._closeMenu()});b.isFunction(c)&&(c=c(a,e));c=b.extend({my:"left top",at:"left bottom",of:a.pageX===k?a.target:a,collision:"fit"},c);this.$menu.show().css({position:"absolute",left:0,top:0}).position(c).hide();this._show(this.$menu,this.options.show,function(){d._trigger.call(d,"open",a,e)})},_closeMenu:function(a){var c=this;a=a?!1:
this.options.hide;b(g).unbind("mousedown"+this.eventNamespace).unbind("touchstart"+this.eventNamespace).unbind("keydown"+this.eventNamespace);c.currentTarget=null;this._hide(this.$menu,a,function(){c._trigger("close")})},_setOption:function(a,c){switch(a){case "menu":this.replaceMenu(c)}b.Widget.prototype._setOption.apply(this,arguments)},_getMenuEntry:function(a,c){var b=this.$menu.find("li a[href=#"+h(a)+"]");return c?b.closest("li"):b},close:function(){this.isOpen()&&this._closeMenu()},enableEntry:function(a,
b){this._getMenuEntry(a,!0).toggleClass("ui-state-disabled",!1===b)},getMenu:function(){return this.$menu},isOpen:function(){return!!this.$menu&&!!this.currentTarget},open:function(a,b){b=b||{};var d=jQuery.Event("contextmenu",{target:a.get(0),extraData:b});return this.element.trigger(d)},replaceMenu:function(a){this._createUiMenu(a)},setEntry:function(a,c){var d;d=this._getMenuEntry(a,!1);"string"===typeof c?d.children("span").length?d.contents().filter(function(){return 3===this.nodeType}).first().replaceWith(c):
d.text(c):(d=d.closest("li").empty(),c.cmd=c.cmd||a,b.moogle.contextmenu.createEntryMarkup(c,d))},showEntry:function(a,b){this._getMenuEntry(a,!0).toggle(!1!==b)}});b.extend(b.moogle.contextmenu,{createEntryMarkup:function(a,c){var d=null;/[^\-\u2014\u2013\s]/.test(a.title)?(d=b("<a/>",{text:""+a.title,href:"#"+h(a.cmd)}).appendTo(c),b.isFunction(a.action)&&d.data("actionHandler",a.action),a.uiIcon&&d.append(b("<span class='ui-icon' />").addClass(a.uiIcon)),a.disabled&&c.addClass("ui-state-disabled"),
b.isPlainObject(a.data)&&d.data(a.data)):c.text(a.title);return d},createMenuMarkup:function(a,c){var d,e,f;null==c&&(c=b("<ul class='ui-helper-hidden' />").appendTo("body"));for(d=0;d<a.length;d++)e=a[d],f=b("<li/>").appendTo(c),b.moogle.contextmenu.createEntryMarkup(e,f),b.isArray(e.children)&&(f=b("<ul/>").appendTo(f),b.moogle.contextmenu.createMenuMarkup(e.children,f));return c}})})(jQuery,window,document);
