/*
 Andrey Lysikov (C) 2014
 Licensed under the MIT license:
   http://www.opensource.org/licenses/mit-license.php
*/
(function(e){e.widget("ui.SlidebarMenu",{options:{position:"left",width:"15",bodyElement:"#slidebarmenu-body",animation_amount:300,minwidth:250,resizable:false,onClose:null,onOpen:null},_create:function(){var t=this;var n=t.element;var r=e(this.options.bodyElement);var i=e(window).width();if(i/100*this.options.width>this.options.minwidth){n.width(i/100*this.options.width)}else{n.width(this.options.minwidth)}if(this.options.position==="left"){var s="-"+n.width();r.width(i-n.width()-s)}else{var s=i;r.width(i)}n.css("left",s+"px");n.addClass("ui-widget ui-state-default slidebar slidebar-animate");n.css("background-image","none");r.addClass("slidebar-animate").css("position","relative");if(this.options.resizable){var o=this.options.position==="left"?"e":"w";n.resizable({handles:o,resize:function(e,n){t.resize(n.size.width)}})}this._CreateMenu(n);r.on("click",function(e){t.close()})},_CreateMenu:function(t){var n=this;var r=this.options;e.each(t.children("li"),function(){var t=e(this);if(t.text()===""){t.addClass("ui-state-default slidebar-item slidebar-item-empty").css("float","left").css("background-image","none")}else{t.addClass("ui-state-default slidebar-item").css("float","left").css("background-image","none");clc=t.children("a").attr("onClick");if(t.parent()[0].localName==="div"){pls=t.children("a").html();t.children("a").empty().append(e("<span />").append(pls));t.width("100%")}t.children("a").find("span").css("float","left");if(clc!==""){t.attr("onClick",clc)}t.children("a").removeAttr("onClick");t.on({mouseenter:function(e){t.addClass("ui-state-hover")},mouseleave:function(e){t.removeClass("ui-state-hover")},click:function(t){var i=e(this);if(i.attr("has_menu")==="true"){var s=i.next("ul");if(s.attr("opened")==="true"){i.children("a").children(".ui-icon-circlesmall-minus").removeClass("ui-icon-circlesmall-minus").addClass("ui-icon-circlesmall-plus");i.removeClass("ui-state-active");s.attr("opened",false);s.slideUp(r.animation_amount)}else{i.parent().children("ul[opened]").attr("opened",false).slideUp(r.animation_amount).prev().children("a").children(".ui-icon-circlesmall-minus").removeClass("ui-icon-circlesmall-minus").addClass("ui-icon-circlesmall-plus");i.parent().children(".ui-state-active").removeClass("ui-state-active");i.children("a").children(".ui-icon-circlesmall-plus").removeClass("ui-icon-circlesmall-plus").addClass("ui-icon-circlesmall-minus");s.attr("opened",true);i.addClass("ui-state-active");s.slideDown(r.animation_amount)}return false}else{n.close()}}});if(t.children("ul").length>0){var i=t.children("ul");i.addClass("slidebar-menu showUp");t.attr("has_menu",true);e("<span>").attr({"class":"ui-icon ui-icon-circlesmall-plus",style:"float:left"}).insertBefore(t.children("a").children("span:first"));i.insertAfter(t).hide().attr("opened",false);t.css("border","0px");n._CreateMenu(i)}else{t.css("border","0px");t.attr("has_menu",false)}}})},resize:function(t){var n=this.element;var r=e(this.options.bodyElement);var i=e(window).width();if(typeof t==="undefined"){t=n.width()}if(t>this.options.minwidth){n.width(t)}else{n.width(this.options.minwidth)}if(n.attr("active")!=="true"){if(this.options.position==="left"){var s="-"+n.width();r.css("left",0+"px")}else{var s=i;r.css("left",i+"px")}r.width(i)}else{if(this.options.position==="left"){var s=0;r.css("left",+(s+n.width())+"px")}else{var s=i-n.width();r.css("left",+-n.width()+"px")}r.width(i)}n.css("left",s+"px")},toggle:function(){var e=this.element;if(e.attr("active")==="false"||e.attr("active")===undefined){this.open()}else{this.close()}},close:function(){var t=this.element;var n=this.options;if(t.attr("active")==="true"){if(e.isFunction(n.onClose)){if(n.onClose.call()){this._animate_hide()}}else{this._animate_hide()}}},open:function(){var t=this.element;var n=this.options;if(t.attr("active")!=="true"){if(e.isFunction(n.onOpen)){if(n.onOpen.call()){this._animate_show()}}else{this._animate_show()}}},_animate_hide:function(){var t=this.element;var n=e(this.options.bodyElement);var r=e(window).width();if(this.options.position==="left"){var i="-"+t.width()}else{var i=r}n.css("left",0+"px");n.width(r);t.css("left",i+"px");setTimeout(function(){t.attr("active",false)},this.options.animation_amount)},_animate_show:function(){var t=this.element;var n=e(this.options.bodyElement);var r=e(window).width();if(this.options.position==="left"){var i=0;n.css("left",+(i+t.width())+"px")}else{var i=r-t.width();n.css("left",+-t.width()+"px")}n.width(r);t.css("left",i+"px");setTimeout(function(){t.attr("active",true)},this.options.animation_amount)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery)