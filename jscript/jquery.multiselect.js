/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, boss:true, undef:true, curly:true, browser:true, jquery:true */
/*
 * jQuery MultiSelect UI Widget 1.14pre
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(c){var j=0,e=c(document);c.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{},appendTo:"body"},_create:function(){var a=this.element.hide(),b=this.options;this.speed=c.fx.speeds._default;this._isOpen=!1;this._namespaceID=this.eventNamespace||"multiselect"+j;a=(this.button=c('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(b.classes).attr({title:a.attr("title"),
"aria-haspopup":!0,tabIndex:a.attr("tabIndex")}).insertAfter(a);(this.buttonlabel=c("<span />")).html(b.noneSelectedText).appendTo(a);var a=(this.menu=c("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(b.classes).appendTo(c(b.appendTo)),d=(this.header=c("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(a);(this.headerLinkContainer=c("<ul />")).addClass("ui-helper-reset").html(function(){return!0===
b.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+b.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+b.uncheckAllText+"</span></a></li>":"string"===typeof b.header?"<li>"+b.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(d);var g=(this.checkboxContainer=
c("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(a);this._bindEvents();this.refresh(!0);b.multiple||a.addClass("ui-multiselect-single");"resizable"in jQuery.ui&&a.resizable({resize:function(a,c){diff=!1===b.header?0:12;b.height=c.size.height-d.height()-diff;g.height(c.size.height-d.height()-diff)}});j++},_init:function(){!1===this.options.header&&this.header.hide().height(0);this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();
this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(a){var b=this.element,d=this.options,g=this.menu,h=this.checkboxContainer,k=[],f="",e=b.attr("id")||j++;b.find("option").each(function(b){c(this);var a=this.parentNode,g=this.innerHTML,h=this.title,j=this.value;b="ui-multiselect-"+(this.id||e+"-option-"+b);var m=this.disabled,p=this.selected,n=["ui-corner-all"],q=(m?"ui-multiselect-disabled ":" ")+this.className,l;"OPTGROUP"===a.tagName&&(l=a.getAttribute("label"),
-1===c.inArray(l,k)&&(f+='<li class="ui-multiselect-optgroup-label '+a.className+'"><a href="#">'+l+"</a></li>",k.push(l)));m&&n.push("ui-state-disabled");p&&!d.multiple&&n.push("ui-state-active");f+='<li class="'+q+'">';f+='<label for="'+b+'" title="'+h+'" class="'+n.join(" ")+'">';f+='<input id="'+b+'" name="multiselect_'+e+'" type="'+(d.multiple?"checkbox":"radio")+'" value="'+j+'" title="'+h+'"';p&&(f+=' checked="checked"',f+=' aria-selected="true"');m&&(f+=' disabled="disabled"',f+=' aria-disabled="true"');
f+=" /><span>"+g+"</span></label></li>"});h.html(f);this.labels=g.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();a||this._trigger("refresh")},update:function(){var a=this.options,b=this.inputs,d=b.filter(":checked"),g=d.length,a=0===g?a.noneSelectedText:c.isFunction(a.selectedText)?a.selectedText.call(this,g,b.length,d.get()):/\d/.test(a.selectedList)&&0<a.selectedList&&g<=a.selectedList?d.map(function(){return c(this).next().text()}).get().join(", "):
a.selectedText.replace("#",g).replace("#",b.length);this._setButtonValue(a);return a},_setButtonValue:function(a){this.buttonlabel.text(a)},_bindEvents:function(){function a(){b[b._isOpen?"close":"open"]();return!1}var b=this,d=this.button;d.find("span").bind("click.multiselect",a);d.bind({click:a,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-hover")},mouseleave:function(){c(this).removeClass("ui-state-hover")},
focus:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-focus")},blur:function(){c(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(a){if(c(this).hasClass("ui-multiselect-close"))b.close();else b[c(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();a.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(a){a.preventDefault();var d=c(this),e=d.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),
f=e.get(),d=d.parent().text();!1!==b._trigger("beforeoptgrouptoggle",a,{inputs:f,label:d})&&(b._toggleChecked(e.filter(":checked").length!==e.length,e),b._trigger("optgrouptoggle",a,{inputs:f,label:d,checked:f[0].checked}))}).delegate("label","mouseenter.multiselect",function(){c(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),c(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(a){a.preventDefault();switch(a.which){case 9:case 27:b.close();
break;case 38:case 40:case 37:case 39:b._traverse(a.which,this);break;case 13:c(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(a){var d=c(this),e=this.value,f=this.checked,j=b.element.find("option");this.disabled||!1===b._trigger("click",a,{value:e,text:this.title,checked:f})?a.preventDefault():(d.focus(),d.attr("aria-selected",f),j.each(function(){this.value===e?this.selected=f:b.options.multiple||(this.selected=!1)}),b.options.multiple||
(b.labels.removeClass("ui-state-active"),d.closest("label").toggleClass("ui-state-active",f),b.close()),b.element.trigger("change"),setTimeout(c.proxy(b.update,b),10))});e.bind("mousedown."+this._namespaceID,function(a){a=a.target;b._isOpen&&(a!==b.button[0]&&a!==b.menu[0]&&!c.contains(b.menu[0],a)&&!c.contains(b.button[0],a))&&b.close()});c(this.element[0].form).bind("reset.multiselect",function(){setTimeout(c.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=
this.options;/\d/.test(b.minWidth)&&a<b.minWidth&&(a=b.minWidth);this.button.outerWidth(a)},_setMenuWidth:function(){this.menu.outerWidth(this.button.outerWidth())},_traverse:function(a,b){var d=c(b),g=38===a||37===a,d=d.parent()[g?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)").first();d.length?d.find("label").trigger("mouseover"):(d=this.menu.find("ul").last(),this.menu.find("label")[g?"last":"first"]().trigger("mouseover"),d.scrollTop(g?d.height():0))},
_toggleState:function(a,b){return function(){this.disabled||(this[a]=b);b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(a,b){var d=b&&b.length?b:this.inputs,g=this;d.each(this._toggleState("checked",a));d.eq(0).focus();this.update();var e=d.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<c.inArray(this.value,e)&&g._toggleState("selected",a).call(this)});d.length&&this.element.trigger("change")},
_toggleDisabled:function(a){this.button.attr({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled");var b=this.menu.find("input"),b=a?b.filter(":enabled").data("ech-multiselect-disabled",!0):b.filter(function(){return!0===c.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled");b.attr({disabled:a,"arial-disabled":a}).parent()[a?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:a,"aria-disabled":a})},open:function(){var a=this.button,
b=this.menu,d=this.speed,g=this.options,e=[];if(!(!1===this._trigger("beforeopen")||a.hasClass("ui-state-disabled")||this._isOpen)){var k=b.find("ul").last(),f=g.show;c.isArray(g.show)&&(f=g.show[0],d=g.show[1]||this.speed);f&&(e=[f,d]);k.scrollTop(0).height(g.height);this.position();c.fn.show.apply(b,e);this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");!g.multiple&&"undefined"!==typeof c(b).find(".ui-state-active").position()&&
k.scrollTop(c(b).find(".ui-state-active").position().top);a.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var a=this.options,b=a.hide,d=this.speed,e=[];c.isArray(a.hide)&&(b=a.hide[0],d=a.hide[1]||this.speed);b&&(e=[b,d]);c.fn.hide.apply(this.menu,e);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},
checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){c.Widget.prototype.destroy.call(this);e.unbind(this._namespaceID);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var a=
this.options;c.ui.position&&!c.isEmptyObject(a.position)?(a.position.of=a.position.of||this.button,this.menu.show().position(a.position).hide()):(a=this.button.offset(),this.menu.css({top:a.top+this.button.outerHeight(),left:a.left}))},_setOption:function(a,b){var d=this.menu;switch(a){case "header":d.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case "checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(b);break;case "uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(b);
break;case "height":d.find("ul").last().height(parseInt(b,10));break;case "minWidth":this.options[a]=parseInt(b,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[a]=b;this.update();break;case "classes":d.add(this.button).removeClass(this.options.classes).addClass(b);break;case "multiple":d.toggleClass("ui-multiselect-single",!b);this.options.multiple=b;this.element[0].multiple=b;this.refresh();break;case "position":this.position()}c.Widget.prototype._setOption.apply(this,
arguments)}})})(jQuery);
(function(c){var j=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;c.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:!1},_create:function(){var e=this.options,a=c(this.element),b=this.instance=a.data("echMultiselect")||a.data("multiselect")||a.data("ech-multiselect");this.header=b.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");e=this.wrapper=c('<div class="ui-multiselect-filter">'+(e.label.length?e.label:"")+'<input placeholder="'+
e.placeholder+'" type="search"'+(/\d/.test(e.width)?'style="width:'+e.width+'px"':"")+" /></div>").prependTo(this.header);this.inputs=b.menu.find('input[type="checkbox"], input[type="radio"]');this.input=e.find("input").bind({keydown:function(a){13===a.which&&a.preventDefault()},keyup:c.proxy(this._handler,this),click:c.proxy(this._handler,this)});this.updateCache();b._toggleChecked=function(a,e){var h=e&&e.length?e:this.labels.find("input"),k=this,h=h.not(b._isOpen?":disabled, :hidden":":disabled").each(this._toggleState("checked",
a));this.update();var f=h.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&-1<c.inArray(this.value,f)&&k._toggleState("selected",a).call(this)});h.length&&this.element.trigger("change")};e=c(document).bind("multiselectrefresh",c.proxy(function(){this.updateCache();this._handler()},this));this.options.autoReset&&e.bind("multiselectclose",c.proxy(this._reset,this))},_handler:function(e){var a=c.trim(this.input[0].value.toLowerCase()),b=this.rows,
d=this.inputs,g=this.cache;if(a){b.hide();var h=RegExp(a.replace(j,"\\$&"),"gi");this._trigger("filter",e,c.map(g,function(a,c){return-1!==a.search(h)?(b.eq(c).show(),d.get(c)):null}))}else b.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var a=c(this),b=a.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return"none"!==c.css(this,"display")}).length;a[b?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=
this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var e=c(this);"optgroup"===this.tagName.toLowerCase()&&(e=e.children());return e.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){c.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);