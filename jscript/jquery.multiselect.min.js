/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, boss:true, undef:true, curly:true, browser:true, jquery:true */
/*
 * jQuery MultiSelect UI Widget 1.14pre
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(c,l){var f=0,g=c(document);c.widget("ech.multiselect",{options:{header:!0,height:175,height_button:19,minWidth:225,minMenuWidth:null,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",separator:", ",selectedList:0,show:null,hide:null,autoOpen:!1,fireChangeOnClose:!1,multiple:!0,position:{},appendTo:"body"},_create:function(){var b=this.element.hide(),a=this.options;this.speed=c.fx.speeds._default;this._isOpen=!1;this._namespaceID=
this.eventNamespace||"multiselect"+f;var d=(this.button_span=c("<span />")).insertAfter(b),e=(this.button=c("<button />")).addClass("ui-multiselect ui-button ui-widget ui-state-default ui-corner-all").addClass(a.classes).attr({title:b.attr("title"),"aria-haspopup":!0,tabIndex:b.attr("tabIndex")}).appendTo(d),b=(this.button_arrow=c("<button />")).addClass("ui-multiselect ui-button ui-widget ui-state-default ui-corner-all").addClass(a.classes).attr({title:b.attr("title"),"aria-haspopup":!0,tabIndex:b.attr("tabIndex")}).appendTo(d),
k=(this.menu=c("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(a.classes).appendTo(c(a.appendTo)),m=(this.header=c("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(k);(this.headerLinkContainer=c("<ul />")).addClass("ui-helper-reset").html(function(){return!0===a.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+a.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+
a.uncheckAllText+"</span></a></li>":"string"===typeof a.header?"<li>"+a.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(m);(this.checkboxContainer=c("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(k);e.button({label:a.noneSelectedText}).height(a.height_button).css("padding","0px");b.button({label:a.noneSelectedText,text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).height(a.height_button).css("padding",
"0px");d.buttonset();this._bindEvents();this.refresh(!0);a.multiple||k.addClass("ui-multiselect-single");"resizable"in jQuery.ui&&!c.browser.msie&&k.resizable({resize:function(b,d){c(this).children("ul").height(d.size.height);a.height=d.size.height}});f++},_init:function(){!1===this.options.header&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},
refresh:function(b){var a=this.element,d=this.options,e=this.menu,k=this.checkboxContainer,m=[],h="",g=a.attr("id")||f++;a.find("option").each(function(a){var b=c(this),k=this.parentNode,e=this.innerHTML,b=this.title||b.text(),f=this.value;a="ui-multiselect-"+(this.id||g+"-option-"+a);var p=this.disabled,l=this.selected,q=["ui-corner-all"],r=(p?"ui-multiselect-disabled ":" ")+this.className,n;"OPTGROUP"===k.tagName&&(n=k.getAttribute("label"),-1===c.inArray(n,m)&&(h+='<li class="ui-multiselect-optgroup-label '+
k.className+'"><a href="#">'+n+"</a></li>",m.push(n)));p&&q.push("ui-state-disabled");l&&!d.multiple&&q.push("ui-state-active");h+='<li class="'+r+'">';h+='<label for="'+a+'" title="'+b+'" class="'+q.join(" ")+'">';h+='<input id="'+a+'" name="multiselect_'+g+'" type="'+(d.multiple?"checkbox":"radio")+'" value="'+f+'" title="'+b+'"';l&&(h+=' checked="checked"',h+=' aria-selected="true"');p&&(h+=' disabled="disabled"',h+=' aria-disabled="true"');h+=" /><span>"+e+"</span></label></li>"});k.html(h);this.labels=
e.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();b||this._trigger("refresh")},update:function(){var b=this.options,a=this.inputs,d=a.filter(":checked"),e=d.length;0===e?a=b.noneSelectedText:c.isFunction(b.selectedText)?a=b.selectedText.call(this,e,a.length,d.get()):/\d/.test(b.selectedList)&&0<b.selectedList&&e<=b.selectedList?(a=d.map(function(){return c(this).next().text()}).get().join(b.separator),""===
a&&(a=b.noneSelectedText)):a=b.selectedText.replace("#",e).replace("#",a.length);this._setButtonValue(a);return a},_setButtonValue:function(b){var a=this.button.outerWidth();if(10*b.length>a)for(var a="",c=b.split(" "),e=0;e<c.length;e++)a=a+" "+c[e],2===e&&(b=a+"...");this.button.children(".ui-button-text").text(b)},_bindEvents:function(){function b(){a[a._isOpen?"close":"open"]();return!1}var a=this,d=this.button_arrow,e=this.button;d.find("span").bind("click.multiselect",b);this.button.find("span").bind("click.multiselect",
b);d.bind({click:b,keydown:function(b){switch(b.which){case 27:case 38:case 37:a.close();break;case 39:case 40:a.open()}},mouseenter:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-hover")},mouseleave:function(){c(this).removeClass("ui-state-hover")},focus:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-focus")},blur:function(){c(this).removeClass("ui-state-focus")}});e.bind({click:b,keydown:function(b){switch(b.which){case 27:case 38:case 37:a.close();
break;case 39:case 40:a.open()}},mouseenter:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-hover")},mouseleave:function(){c(this).removeClass("ui-state-hover")},focus:function(){d.hasClass("ui-state-disabled")||c(this).addClass("ui-state-focus")},blur:function(){c(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(b){if(c(this).hasClass("ui-multiselect-close"))a.close();else a[c(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();
b.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(b){b.preventDefault();var d=c(this),e=d.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),f=e.get(),d=d.parent().text();!1!==a._trigger("beforeoptgrouptoggle",b,{inputs:f,label:d})&&(a._toggleChecked(e.filter(":checked").length!==e.length,e),a._trigger("optgrouptoggle",b,{inputs:f,label:d,checked:f[0].checked}))}).delegate("label","mouseenter.multiselect",
function(){c(this).hasClass("ui-state-disabled")||(a.labels.removeClass("ui-state-hover"),c(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(b){b.preventDefault();switch(b.which){case 9:case 27:a.close();d.focus();break;case 38:case 40:case 37:case 39:a._traverse(b.which,this);break;case 13:case 32:c(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(b){var d=c(this),e=this.value,
f=this.checked,g=a.element.find("option");this.disabled||!1===a._trigger("click",b,{value:e,text:this.title,checked:f})?b.preventDefault():(d.focus(),d.attr("aria-selected",f),g.each(function(){this.value===e?this.selected=f:a.options.multiple||(this.selected=!1)}),a.options.multiple||(a.labels.removeClass("ui-state-active"),d.closest("label").toggleClass("ui-state-active",f),a.close()),a.options.fireChangeOnClose?a.didChanged=!0:a.element.trigger("change"),setTimeout(c.proxy(a.update,a),10))});g.bind("mousedown."+
this._namespaceID,function(b){b=b.target;!a._isOpen||b===a.button[0]||b===a.menu[0]||c.contains(a.menu[0],b)||c.contains(a.button[0],b)||a.close()});c(this.element[0].form).bind("reset."+this._namespaceID,function(){setTimeout(c.proxy(a.refresh,a),10)})},_setButtonWidth:function(){var b=this.element.outerWidth(),a=this.options;/\d/.test(a.minWidth)&&b<a.minWidth&&(b=a.minWidth);this.button.outerWidth(b-35);this.button_span.outerWidth(b+this.button_arrow.outerWidth())},_setMenuWidth:function(){var b=
this.menu,a=this.button_span.outerWidth(),c=this.options;/\d/.test(c.minMenuWidth)&&a<c.minMenuWidth&&(a=c.minMenuWidth);b.outerWidth(a)},_traverse:function(b,a){var d=c(a),e=38===b||37===b,d=d.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)").first();d.length?d.find("label").trigger("mouseover"):(d=this.menu.find("ul").last(),this.menu.find("label")[e?"last":"first"]().trigger("mouseover"),d.scrollTop(e?d.height():0))},_toggleState:function(b,a){return function(){this.disabled||
(this[b]=a);a?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(b,a){var d=a&&a.length?a:this.inputs,e=this;d.each(this._toggleState("checked",b));d.eq(0).focus();this.update();var f=d.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<c.inArray(this.value,f)&&e._toggleState("selected",b).call(this)});d.length&&this.element.trigger("change")},_toggleDisabled:function(b){this.button.attr({disabled:b,
"aria-disabled":b})[b?"addClass":"removeClass"]("ui-state-disabled");this.button_arrow.attr({disabled:b,"aria-disabled":b})[b?"addClass":"removeClass"]("ui-state-disabled");var a=this.menu.find("input"),a=b?a.filter(":enabled").data("ech-multiselect-disabled",!0):a.filter(function(){return!0===c.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled");a.attr({disabled:b,"arial-disabled":b}).parent()[b?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:b,
"aria-disabled":b})},open:function(b){b=this.button;var a=this.menu,d=this.speed,e=this.options,f=[];if(!1!==this._trigger("beforeopen")&&!b.hasClass("ui-state-disabled")&&!this._isOpen){var g=a.find("ul").last(),h=e.show;c.isArray(e.show)&&(h=e.show[0],d=e.show[1]||this.speed);h&&(f=[h,d]);g.scrollTop(0).height(e.height);this.position();c.fn.show.apply(a,f);this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");e.multiple||"undefined"===
typeof c(a).find(".ui-state-active").position()||g.scrollTop(c(a).find(".ui-state-active").position().top);b.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var b=this.options,a=b.hide,d=this.speed,e=[];c.isArray(b.hide)&&(a=b.hide[0],d=b.hide[1]||this.speed);a&&(e=[a,d]);c.fn.hide.apply(this.menu,e);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");b.fireChangeOnClose&&this.didChanged&&(this.element.trigger("change"),
this.didChanged=!1);this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(b){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){c.Widget.prototype.destroy.call(this);g.unbind(this._namespaceID);c(this.element[0].form).unbind(this._namespaceID);
this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var b=this.options;c.ui.position&&!c.isEmptyObject(b.position)?(b.position.of=b.position.of||this.button,this.menu.show().position(b.position).hide()):(b=this.button.offset(),this.menu.css({top:b.top+this.button.outerHeight(),left:b.left}))},_setOption:function(b,a){var d=this.menu;switch(b){case "header":d.find("div.ui-multiselect-header")[a?
"show":"hide"]();break;case "checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(a);break;case "uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(a);break;case "height":d.find("ul").last().height(parseInt(a,10));break;case "minWidth":this.options[b]=parseInt(a,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[b]=a;this.update();break;case "classes":d.add(this.button).removeClass(this.options.classes).addClass(a);
break;case "multiple":d.toggleClass("ui-multiselect-single",!a);this.options.multiple=a;this.element[0].multiple=a;this.refresh();break;case "position":this.position()}c.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);
(function(c){var l=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;c.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:!1,has_clear_button:!0},_create:function(){var f=this.options,g=c(this.element),g=this.instance=g.data("echMultiselect")||g.data("multiselect")||g.data("ech-multiselect");this.header=g.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");var b;f.has_clear_button&&(b=c("<span />").attr({"class":"ui-icon ui-icon-closethick",
style:"float:left;top:8px;left:150px;position: absolute; cursor: pointer;"}).on("click",function(){c(this).parent().find("input").val("").click()}));f=this.wrapper=c('<div class="ui-multiselect-filter">'+(f.label.length?f.label:"")+"</div>").append('<input placeholder="'+f.placeholder+'" type="search"'+(/\d/.test(f.width)?'style="width:'+f.width+'px"':"")+" />").append(b).prependTo(this.header);this.inputs=g.menu.find('input[type="checkbox"], input[type="radio"]');this.input=f.find("input").bind({keydown:function(a){13===
a.which&&a.preventDefault()},keyup:c.proxy(this._handler,this),click:c.proxy(this._handler,this)});this.updateCache();g._toggleChecked=function(a,b){var e=b&&b.length?b:this.labels.find("input"),f=this,e=e.not(f._isOpen?":disabled, :hidden":":disabled").each(this._toggleState("checked",a));this.update();var g=e.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&-1<c.inArray(this.value,g)&&f._toggleState("selected",a).call(this)});e.length&&this.element.trigger("change")};
f=c(document).bind("multiselectrefresh."+g._namespaceID,c.proxy(function(){this.updateCache();this._handler()},this));this.options.autoReset&&f.bind("multiselectclose."+g._namespaceID,c.proxy(this._reset,this))},_handler:function(f){var g=c.trim(this.input[0].value.toLowerCase()),b=this.rows,a=this.inputs,d=this.cache;if(g){b.hide();var e=RegExp(g.replace(l,"\\$&"),"gi");this._trigger("filter",f,c.map(d,function(c,d){return-1!==c.search(e)?(b.eq(d).show(),a.get(d)):null}))}else b.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var a=
c(this),b=a.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return"none"!==c.css(this,"display")}).length;a[b?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var f=c(this);"optgroup"===this.tagName.toLowerCase()&&(f=f.children());return f.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},
widget:function(){return this.wrapper},destroy:function(){c.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);