/*
 Andrey Lysikov (C) 2014
 Licensed under the MIT license:
   http://www.opensource.org/licenses/mit-license.php
 Part of IWS system
 Based on jqgrid: https://github.com/tonytomov/jqGrid
 from jqgrid we need only modules:
 grid.base,
 grid.custom (setGridState,GridUnload,GridDestroy,clearBeforeUnload,sortGrid,setColProp,getColProp,destroyFrozenColumns,setGroupHeaders,destroyGroupHeader),
 grid.formedit (navSeparatorAdd,navButtonAdd,navGrid),
 grid.grouping,
 grid.treegrid,
 grid.jqueryui,
 grid.fmatter
*/
$.jgrid.extend({editGridRow:function(a,g){g=$.extend(!0,{modal:!0,resize:!0,mtype:"POST",addedrow:"last",reloadAfterSubmit:!0,beforeSubmit:null,afterSubmit:null,recreateForm:!1,closeOnEscape:!1,serializeEditData:null},$.jgrid.edit,g||{});var c=this;CreateEditDialog=function(e){var h=c.jqGrid("getGridParam","colModel"),p=c.jqGrid("getGridParam","colNames"),l=c.jqGrid("getGridParam","treeGrid"),b=c.attr("id"),d=$("<form />").attr({name:"FormPost",id:"editmod"+b,onsubmit:"return false;",style:"text-align: left;"}),
k=$("<table />").attr({id:"TblGrid_"+b,"class":"EditTable",cellspacing:"0",cellpadding:"0",border:"0"});$("#dialog_editmod"+b).dialog("destroy").remove();$(h).each(function(b){if("undefined"!==typeof h[b].editoptions){var a="",c="";$.each(h[b].editoptions,function(a,d){"value"!==a&&(c=c+a+'="'+d+'" ',"grouping_row"===a&&"true"===d&&(h[b].hidden=!1))});h[b].editable||(h[b].hidden_tmp=!0);h[b].hidden&&(h[b].hidden_tmp=!0);h[b].edittype||(h[b].edittype="text");switch(h[b].edittype){case "text":a='<input class="FormElement ui-widget-content ui-corner-all" id="'+
h[b].index+'" name="'+h[b].index+'" type="text" '+c+' value="'+e[h[b].index]+'" />';break;case "checkbox":"1"===e[h[b].index]&&(c+='checked="checked"');a='<input class="FormElement ui-widget-content ui-corner-all" id="'+h[b].index+'" name="'+h[b].index+'" type="checkbox" '+c+" />";break;case "password":a='<input class="FormElement ui-widget-content ui-corner-all" id="'+h[b].index+'" name="'+h[b].index+'" type="password" '+c+' value="" />';break;case "textarea":a='<textarea class="FormElement ui-widget-content ui-corner-all" id="'+
h[b].index+'" '+c+' name="'+h[b].index+'" >'+e[h[b].index]+"</textarea>";break;case "select":a='<select class="FormElement ui-widget-content ui-corner-all" id="'+h[b].index+'" '+c+' name="'+h[b].index+'"  >',$.each(h[b].editoptions.value.split(";"),function(c,d){sel="";el=d.split(":");h[b].editoptions.multiple?val=e[h[b].index].split(","):"undefined"!==typeof e[h[b].index]&&(val=e[h[b].index].split("~|"));$.each(val,function(b,a){$.trim(a)===$.trim(el[0])&&(sel="selected")});a=a+'<option value="'+
el[0]+'" '+sel+">"+el[1]+"</option>"}),a+="</select>"}h[b].editoptions.title||(h[b].editoptions.title="");table_elements=$("<tr />").attr({id:"tr_"+h[b].index,"class":"FormData",title:h[b].editoptions.title,style:h[b].hidden_tmp?"display:none":""});table_elements.append($("<td />").attr({"class":"CaptionTD",style:"width:150px;"}).append(p[b]));table_elements.append($("<td />").attr({"class":"DataTD"}).append(a));k.append(table_elements)}});if($.isFunction(create_from_table_elements)){$.isFunction(replace_select_opt_group)&&
replace_select_opt_group(k);var f=create_from_table_elements(k)+200+60}else f=710;d.append(k);d.append('<input type="hidden" name="id" value="'+a+'"><input type="hidden" name="oper" value="edit">');bSubmit=$.jgrid.edit.bSubmit;bCancel=$.jgrid.edit.bCancel;$("<div>").attr({id:"dialog_editmod"+c.attr("id"),"class":"FormElement ui-jqdialog-content"}).append(d).dialog({autoOpen:!1,modal:!1,minWidth:450,width:f,appendTo:$(".ui-tabs-panel[aria-hidden='false']").children(".tab_main_content"),closeOnEscape:g.closeOnEscape,
resizable:g.resize,buttons:[{text:bSubmit,click:function(){var a=$(this),d=[];$.each($("#editmod"+b).find("input, select, textarea"),function(){var b=$(this);c.attr("for_object_db");void 0!==b.attr("name")&&("B"===b.attr("row_type")?d[b.attr("name")]="checked"===b.attr("checked")?1:0:d[b.attr("name")]=b.val())});d=$.extend({},d);"new"===d.id&&(d.oper="add",l&&(d.ID_PARENT=c.jqGrid("getGridParam","selrow")));var f=!0;$.isFunction(g.serializeEditData)&&(d=g.serializeEditData.call(g,d));$.isFunction(g.beforeSubmit)&&
(ret=g.beforeSubmit.call(g,d,$("#editmod"+b)),f="undefined"!==typeof ret?ret[0]:!1);f&&($("#btn_s_"+b).button("option","disabled",!0),$("#btn_c_"+b).button("option","disabled",!0),$.ajax({url:c.jqGrid("getGridParam","editurl"),datatype:"json",data:d,cache:!1,type:g.mtype,success:function(e,h){f=!0;var p={};p.statusText=h;p.responseText=e;$.isFunction(g.afterSubmit)&&(ret=g.afterSubmit.call(g,p,d,b),f="undefined"!==typeof ret?ret[0]:!1);f&&("add"!==d.oper?(delete d.oper,c.jqGrid("setRowData",d.id,
d)):(delete d.oper,delete d.id,p=[],p[$("#editmod"+b).find("input[index_field='true']").attr("id")]=ret[2],d=$.extend(d,p),l?c.jqGrid("addChildNode",ret[2],d.ID_PARENT,d):c.jqGrid("addRowData",ret[2],d,g.addedrow)),a.dialog("close"));$("#btn_s_"+b).button("option","disabled",!1);$("#btn_c_"+b).button("option","disabled",!1)}}))}},{text:bCancel,click:function(){$(this).dialog("close")}}],close:function(){$(this).parent().parent().children(".ui-widget-overlay").remove();$(this).dialog("close")},open:function(){var d=
$(this).parent();d.children(".ui-dialog-buttonpane").find('button:contains("'+bCancel+'")').button({icons:{primary:"ui-icon-close"}}).prop("id","btn_c_"+b);d.children(".ui-dialog-buttonpane").find('button:contains("'+bSubmit+'")').button({icons:{primary:"ui-icon-disk"}}).prop("id","btn_s_"+b);$($("<div />").attr({"class":"ui-widget-overlay ui-front dialog_jqgrid_overlay ui-corner-all",style:"position:absolute;z-index:99"})).prependTo(d.parent());redraw_document($(".ui-tabs-panel[aria-hidden='false']"))}})};
var e=$("#editmod"+c.attr("id"));if("new"!==a)var l=c.jqGrid("getRowData",a);else{var l=[],k=c.jqGrid("getGridParam","colModel");$(k).each(function(a){"undefined"!==typeof k[a].editoptions&&(l[k[a].index]="")});l=$.extend({},l)}g.recreateForm||0===e.length||e.attr("type_dialog_form")!==a?CreateEditDialog(l):(e=$("#editmod"+c.attr("id")),$.each(l,function(a,c){var e=$("#"+a);"SB"===e.attr("row_type")?(e.children("option").removeAttr("selected"),c=e.attr("multiple")?c.split(","):c.split("~|"),$.each(c,
function(a,b){e.find("option[value='"+$.trim(b)+"']").attr("selected","")})):"B"===e.attr("row_type")?"1"===c?e.attr({checked:"checked"}):e.removeAttr("checked"):e.val(c)}),$.isFunction(replace_select_opt_group)&&replace_select_opt_group(e),$.isFunction(update_table_elemnts)&&update_table_elemnts(e));e.find('input[name="oper"]').val("edit");e.find('input[name="id"]').val(a);e="new"!==a?"edit":"new";$("#dialog_editmod"+c.attr("id")).dialog("option","title",g.editCaption).dialog("open").attr("type_dialog_form",
e)},viewGridRow:function(a,g){g=$.extend(!0,{modal:!1,resize:!0,closeOnEscape:!1,viewPagerButtons:!0},$.jgrid.view,g||{});var c=0,e=this.jqGrid("getGridParam","colModel"),l=this.jqGrid("getGridParam","colNames"),k=this.attr("id"),m=this.jqGrid("getRowData",a),h=$("<table />").attr({id:"TblGrid_"+k,"class":"EditTable",cellspacing:"0",cellpadding:"0",border:"0"});$(e).each(function(a){if("undefined"!==typeof e[a].editoptions){e[a].edittype||(e[a].edittype="text");e[a].editable||(e[a].hidden=!0);var g=
"disabled ";$.each(e[a].editoptions,function(b,a){"value"!==b&&("w"===b&&(parseInt(a)>c&&(c=parseInt(a)),b="style",a="width:"+a+"px;"),g=g+b+'="'+a+'" ')});switch(e[a].edittype){case "text":elem='<input class="FormElement ui-widget-content ui-corner-all"  type="text" '+g+' value="'+m[e[a].index]+'" />';break;case "checkbox":"1"===m[e[a].index]&&(g+='checked="checked"');elem='<input class="FormElement ui-widget-content ui-corner-all" type="checkbox" '+g+" />";break;case "password":elem='<input class="FormElement ui-widget-content ui-corner-all" type="password" '+
g+' value="" />';break;case "textarea":elem='<textarea class="FormElement ui-widget-content ui-corner-all" '+g+">"+m[e[a].index]+"</textarea>";break;case "select":case "select":elem='<select class="FormElement ui-widget-content ui-corner-all"  '+g+"  >",$.each(e[a].editoptions.value.split(";"),function(b,d){sel="";el=d.split(":");val=e[a].editoptions.multiple?m[e[a].index].split(","):m[e[a].index].split("~|");$.each(val,function(b,a){$.trim(a)===$.trim(el[0])&&(sel="selected")});elem=elem+'<option value="'+
el[0]+'" '+sel+">"+el[1]+"</option>"}),elem+="</select>"}e[a].editoptions.title||(e[a].editoptions.title="");table_elements=$("<tr />").attr({id:"tr_"+e[a].index,"class":"FormData",title:e[a].editoptions.title,style:e[a].hidden?"display:none":""});table_elements.append($("<td />").attr({"class":"CaptionTD",style:"width:150px;text-align:left;padding:5px;"}).append("<b>"+l[a]+"</b>"));table_elements.append($("<td />").attr({"class":"DataTD",style:"text-align:left;padding:5px;"}).append(elem));h.append(table_elements)}});
$("<div>").attr({id:"dialog_viewmod"+this.attr("id"),"class":"FormElement ui-jqdialog-content"}).append(h).dialog({autoOpen:!0,modal:!1,minWidth:350,appendTo:$(".ui-tabs-panel[aria-hidden='false']").children(".tab_main_content"),title:$.jgrid.view.caption,closeOnEscape:g.closeOnEscape,resizable:g.resize,width:c+300,buttons:[{text:$.jgrid.view.bClose,click:function(){$(this).dialog("close")}}],close:function(){$(this).parent().parent().children(".ui-widget-overlay").remove();$(this).dialog("close");
$(this).dialog("destroy").remove()},open:function(){var a=$(this).parent();a.children(".ui-dialog-buttonpane").find('button:contains("'+$.jgrid.view.bClose+'")').button({icons:{primary:"ui-icon-close"}}).prop("id","btn_c_"+k);$($("<div />").attr({"class":"ui-widget-overlay ui-front dialog_jqgrid_overlay ui-corner-all",style:"position:absolute;z-index:99"})).prependTo(a.parent());redraw_document()}})},delGridRow:function(a,g){g=$.extend(!0,{resize:!0,mtype:"POST"},$.jgrid.del,g||{});var c=this,e=c.attr("id");
$.isArray(a)&&(a=a.join(","));$("<div>").attr({id:"dialog_delmod"+c.attr("id"),"class":"FormElement ui-jqdialog-content"}).append($.jgrid.del.msg).dialog({autoOpen:!0,modal:!1,minWidth:350,appendTo:$(".ui-tabs-panel[aria-hidden='false']").children(".tab_main_content"),title:$.jgrid.del.caption,closeOnEscape:g.closeOnEscape,resizable:g.resize,buttons:[{text:$.jgrid.del.bSubmit,click:function(){var l=$(this);$("#btn_d_"+e).button("option","disabled",!0);$("#btn_c_"+e).button("option","disabled",!0);
var k={};k.id=a;k.oper="del";$.ajax({url:c.jqGrid("getGridParam","editurl"),datatype:"json",data:k,cache:!1,type:g.mtype,success:function(g,h){$.each(a.split(","),function(a,e){c.jqGrid("delRowData",e)});l.dialog("close");$("#btn_d_"+e).button("option","disabled",!1);$("#btn_c_"+e).button("option","disabled",!1)}})}},{text:$.jgrid.del.bCancel,click:function(){$(this).dialog("close")}}],close:function(){$(this).parent().parent().children(".ui-widget-overlay").remove();$(this).dialog("close");$(this).dialog("destroy").remove()},
open:function(){var a=$(this).parent();a.children(".ui-dialog-buttonpane").find('button:contains("'+$.jgrid.del.bCancel+'")').button({icons:{primary:"ui-icon-close"}}).prop("id","btn_c_"+e);a.children(".ui-dialog-buttonpane").find('button:contains("'+$.jgrid.del.bSubmit+'")').button({icons:{primary:"ui-icon-trash"}}).prop("id","btn_d_"+e);$($("<div />").attr({"class":"ui-widget-overlay ui-front dialog_jqgrid_overlay ui-corner-all",style:"position:absolute;z-index:99"})).prependTo(a.parent());redraw_document()}})},
columnChooser:function(a){var g=this;if(!$("#colchooser_"+$.jgrid.jqID(g[0].p.id)).length){var c=g.jqGrid("getGridParam","colModel"),e=g.jqGrid("getGridParam","colNames"),l=$("<div />").attr({id:"colchooser_"+g[0].p.id,style:"position:relative;overflow-y:enable"}),k=$("<ol />").attr({style:"list-style-type: none; margin: 0; padding: 0; width: 100%;"});k.bind("mousedown",function(a){a.metaKey=!0}).selectable({selected:function(a,c){$(c.selected).addClass("ui-state-active")},unselected:function(a,c){$(c.unselected).removeClass("ui-state-active")}});
$.each(c,function(a){this.hidedlg||(a=$("<li />").attr({value:a,"class":"ui-widget-content ui-state-default",style:"margin: 3px; padding: 0.4em; font-size: 0.8em; height: 12px; text-align:left; cursor:pointer;"}).html(e[a].replace("<br>"," ").replace("<BR>"," ")),this.hidden||a.addClass("ui-state-active").addClass("ui-selected"),k.append(a))});l.append(k).dialog({autoOpen:!0,modal:!1,appendTo:$(".ui-tabs-panel[aria-hidden='false']").children(".tab_main_content"),title:$.jgrid.col.caption,width:a.width,
height:a.height,resizable:!0,buttons:[{text:$.jgrid.col.bSubmit,click:function(){$.each(k.find("li"),function(a,e){var k=$(this).val();$(this).hasClass("ui-selected")?g.jqGrid("showCol",c[k].name):g.jqGrid("hideCol",c[k].name)});$(this).dialog("close")}},{text:$.jgrid.col.bCancel,click:function(){$(this).dialog("close")}}],close:function(){$(this).parent().parent().children(".ui-widget-overlay").remove();$(this).dialog("close");$(this).dialog("destroy").remove();redraw_document()},open:function(){var a=
$(this).parent();a.children(".ui-dialog-buttonpane").find('button:contains("'+$.jgrid.col.bCancel+'")').button({icons:{primary:"ui-icon-close"}});a.children(".ui-dialog-buttonpane").find('button:contains("'+$.jgrid.col.bSubmit+'")').button({icons:{primary:"ui-icon-disk"}});$($("<div />").attr({"class":"ui-widget-overlay ui-front dialog_jqgrid_overlay ui-corner-all",style:"position:absolute;z-index:99"})).prependTo(a.parent());redraw_document()}})}},filterToolbar:function(a){a=$.extend({autosearch:!0,
searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw"},a||{});return this.each(function(){function g(a,d){var c=$(a);c[0]&&jQuery.each(d,function(){void 0!==this.data?c.bind(this.type,this.data,this.fn):c.bind(this.type,this.fn)})}var c=this,e=$(this).parent().parent().parent().prop("id"),l=!1;if(!this.ftoolbar){var k=function(){var b={},d=0,g,f,h={},k;$.each(c.p.colModel,function(){f=this.index||this.name;
k=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"select"==this.stype?"eq":a.defaultSearch;g=$("#gs_"+e+"_"+$.jgrid.jqID(this.name),!0===this.frozen&&!0===c.p.frozenColumns?c.grid.fhDiv:c.grid.hDiv).val();l=!0;if(g)" ui-icon  ui-icon-close"==$("#search_"+e+"_"+$.jgrid.jqID(this.name)).prop("class")&&$("#search_"+e+"_"+$.jgrid.jqID(this.name)).attr({"class":" ui-icon  ui-icon-radio-off",title:"\u0432\u0445\u043e\u0434\u0438\u0442",value:"LIKE"}),b[f]=$("#search_"+e+"_"+$.jgrid.jqID(this.name)).attr("value")+
">"+$("#gs_"+e+"_"+$.jgrid.jqID(this.name)).prop("value"),h[f]=k,d++;else try{delete c.p.postData[f]}catch(u){}});var p=0<d?!0:!1;if(!0===a.stringResult||"local"==c.p.datatype){var n='{"groupOp":"'+a.groupOp+'","rules":[',m=0;$.each(b,function(a,b){0<m&&(n+=",");n+='{"field":"'+a+'",';n+='"op":"'+h[a]+'",';n+='"data":"'+(b+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';m++});n+="]}";$.extend(c.p.postData,{filters:n});$.each(["searchField","searchString","searchOper"],function(a,b){c.p.postData.hasOwnProperty(b)&&
delete c.p.postData[b]})}else $.extend(c.p.postData,b);var t;c.p.searchurl&&(t=c.p.url,$(c).jqGrid("setGridParam",{url:c.p.searchurl}));var u="stop"===$(c).triggerHandler("jqGridToolbarBeforeSearch")?!0:!1;!u&&$.isFunction(a.beforeSearch)&&(u=a.beforeSearch.call(c));u||$(c).jqGrid("setGridParam",{search:p}).trigger("reloadGrid",[{page:1}]);t&&$(c).jqGrid("setGridParam",{url:t});$(c).triggerHandler("jqGridToolbarAfterSearch");$.isFunction(a.afterSearch)&&a.afterSearch.call(c)},m=function(b){var d=
{},g=0,f;b="boolean"!=typeof b?!0:b;$.each(c.p.colModel,function(){var a;this.searchoptions&&void 0!==this.searchoptions.defaultValue&&(a=this.searchoptions.defaultValue);f=this.index||this.name;$("#search_"+e+"_"+$.jgrid.jqID(this.name)).prop({"class":" ui-icon  ui-icon-close",title:"\u041d\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f",value:"NONE"});$("#gs_"+e+"_"+$.jgrid.jqID(this.name)).prop({value:""});switch(this.stype){case "select":$("#gs_"+$.jgrid.jqID(this.name)+
" option",!0===this.frozen&&!0===c.p.frozenColumns?c.grid.fhDiv:c.grid.hDiv).each(function(b){0===b&&(this.selected=!0);if($(this).val()==a)return this.selected=!0,!1});if(void 0!==a)d[f]=a,g++;else try{delete c.p.postData[f]}catch(b){}break;case "text":if($("#gs_"+$.jgrid.jqID(this.name),!0===this.frozen&&!0===c.p.frozenColumns?c.grid.fhDiv:c.grid.hDiv).val(a),void 0!==a)d[f]=a,g++;else try{delete c.p.postData[f]}catch(h){}}});var h=0<g?!0:!1;if(!0===a.stringResult||"local"==c.p.datatype){var k=
'{"groupOp":"'+a.groupOp+'","rules":[',l=0;$.each(d,function(a,b){0<l&&(k+=",");k+='{"field":"'+a+'",';k+='"op":"eq",';k+='"data":"'+(b+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';l++});k+="]}";$.extend(c.p.postData,{filters:k});$.each(["searchField","searchString","searchOper"],function(a,b){c.p.postData.hasOwnProperty(b)&&delete c.p.postData[b]})}else $.extend(c.p.postData,d);var n;c.p.searchurl&&(n=c.p.url,$(c).jqGrid("setGridParam",{url:c.p.searchurl}));var m="stop"===$(c).triggerHandler("jqGridToolbarBeforeClear")?
!0:!1;!m&&$.isFunction(a.beforeClear)&&(m=a.beforeClear.call(c));m||b&&$(c).jqGrid("setGridParam",{search:h}).trigger("reloadGrid",[{page:1}]);n&&$(c).jqGrid("setGridParam",{url:n});$(c).triggerHandler("jqGridToolbarAfterClear");$.isFunction(a.afterClear)&&a.afterClear()},h=function(){var a=$("tr.ui-search-toolbar",c.grid.hDiv),d=!0===c.p.frozenColumns?$("tr.ui-search-toolbar",c.grid.fhDiv):!1;"none"==a.css("display")?(a.show(),$("#"+e).children(".ui-jqgrid-bdiv").height($("#"+e).children(".ui-jqgrid-bdiv").height()-
27),l=!1,d&&d.show()):(a.hide(),$("#"+e).children(".ui-jqgrid-bdiv").height($("#"+e).children(".ui-jqgrid-bdiv").height()+27),l&&m(),d&&d.hide())},p=$("<tr class='ui-search-toolbar' role='rowheader'></tr>"),q;$.each(c.p.colModel,function(){var b=this,d,h,f,l;h=$("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+c.p.direction+"'></th>");d=$("<div style='text-align:left;position:relative;vertical-align:middle'></div>");!0===this.hidden&&$(h).css("display","none");this.search=!1===
this.search?!1:!0;"undefined"==typeof b.formatter&&(b.formatter="text");f=$.extend({},this.searchoptions||{});if(this.search)switch(b.formatter){case "select":if(l=this.surl||f.dataUrl)$.ajax($.extend({url:l,dataType:"html",success:function(c){void 0!==f.buildSelect?(c=f.buildSelect(c))&&$(d).append(c):$(d).append(c);void 0!==f.defaultValue&&$("select",d).val(f.defaultValue);$("select",d).prop({name:b.index||b.name,id:"gs_"+e+"_"+b.name});$("select",d).css("float","left").css("padding-left","15px");
$("select",d).prop("class","ui-state-default");f.prop&&$("select",d).prop(f.prop);$("select",d).css({width:"100%"});void 0!==f.dataInit&&f.dataInit($("select",d)[0]);void 0!==f.dataEvents&&g($("select",d)[0],f.dataEvents);!0===a.autosearch&&$("select",d).change(function(){k();return!1});c=null}},$.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{}));else{var m,r,n;b.searchoptions?(m=void 0===b.searchoptions.value?"":b.searchoptions.value,r=void 0===b.searchoptions.separator?":":b.searchoptions.separator,
n=void 0===b.searchoptions.delimiter?";":b.searchoptions.delimiter):b.editoptions&&(m=void 0===b.editoptions.value?"":b.editoptions.value,r=void 0===b.editoptions.separator?":":b.editoptions.separator,n=void 0===b.editoptions.delimiter?";":b.editoptions.delimiter);if(m){l=document.createElement("select");l.style.width="100%";$(l).prop({name:b.index||b.name,id:"gs_"+e+"_"+b.name});var s;if("string"===typeof m){m=m.split(n);for(var t=0;t<m.length;t++)s=m[t].split(r),n=document.createElement("option"),
n.value=s[0],n.innerHTML=s[1],l.appendChild(n)}else if("object"===typeof m)for(s in m)m.hasOwnProperty(s)&&(n=document.createElement("option"),n.value=s,n.innerHTML=m[s],l.appendChild(n));void 0!==f.defaultValue&&$(l).val(f.defaultValue);f.prop&&$(l).prop(f.prop);void 0!==f.dataInit&&f.dataInit(l);void 0!==f.dataEvents&&g(l,f.dataEvents);$(d).append(l);replace_select_opt_group($(d));1<$(d).find("option:empty").length&&$(d).find("option:empty:first").remove();$(d).children("select").multiselect({multiple:void 0===
b.editoptions.multiple?!1:b.editoptions.multiple,minWidth:b.width,header:!1,selectedList:void 0===b.editoptions.size?1:b.editoptions.size}).css("padding","0.3em");!0===a.autosearch&&$(l).change(function(){k();return!1})}}break;case "checkbox":r=void 0!==f.defaultValue?f.defaultValue:"";$(d).append("<input type='checkbox' class='ui-widget ui-widget-content ui-corner-all' name='"+(b.index||b.name)+"' id='gs_"+e+"_"+b.name+"' value=''/>");$(d).css("text-align","center");$(d).children("input").before("<label for='gs_"+
e+"_"+b.name+"'>\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e \u0438\u043b\u0438 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u043e</label>").button({icons:{primary:"ui-icon-check"},text:!1});f.prop&&$("input",d).prop(f.prop);void 0!==f.dataInit&&f.dataInit($("input",d)[0]);void 0!==f.dataEvents&&g($("input",d)[0],f.dataEvents);!0===a.autosearch&&$("input",d).click(function(){"1"==$("input",d).prop("value")?$("input",d).prop({value:"0"}):$("input",d).prop({value:"1"});k()});break;case "date":r=
void 0!==f.defaultValue?f.defaultValue:"";$(d).append("<input type='text' style='width:95%;padding-left:15px;' class='FormElement ui-widget ui-widget-content ui-corner-all' name='"+(b.index||b.name)+"' id='gs_"+e+"_"+b.name+"' value='"+r+"'/>");f.prop&&$("input",d).prop(f.prop);void 0!==f.dataInit&&f.dataInit($("input",d)[0]);void 0!==f.dataEvents&&g($("input",d)[0],f.dataEvents);$("input",d).datetimepicker({changeYear:!0,firstDay:1,timeFormat:"HH:mm:ss"});!0===a.autosearch&&(a.searchOnEnter?$("input",
d).keypress(function(a){return 13==(a.charCode?a.charCode:a.keyCode?a.keyCode:0)?(k(),!1):this}):$("input",d).keydown(function(a){switch(a.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:q&&clearTimeout(q),q=setTimeout(function(){k()},500)}}));break;case "number":r=void 0!==f.defaultValue?f.defaultValue:"";$(d).append("<input type='text' class='FormElement' name='"+(b.index||b.name)+"' id='gs_"+e+"_"+b.name+"' style='float:left;width:93%;' value='"+r+"'/>");
$(d).children("input").spinner({numberFormat:"n2",culture:"ru-RU",step:1}).css({width:"95%","padding-left":"15px"});f.prop&&$("input",d).prop(f.prop);void 0!==f.dataInit&&f.dataInit($("input",d)[0]);void 0!==f.dataEvents&&g($("input",d)[0],f.dataEvents);!0===a.autosearch&&(a.searchOnEnter?$("input",d).keypress(function(a){return 13==(a.charCode?a.charCode:a.keyCode?a.keyCode:0)?(k(),!1):this}):$("input",d).keydown(function(a){switch(a.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;
default:q&&clearTimeout(q),q=setTimeout(function(){k()},500)}}));break;default:r=void 0!==f.defaultValue?f.defaultValue:"",$(d).append("<input type='text' style='width:95%;padding-left:15px;' class='FormElement ui-widget ui-widget-content ui-corner-all' name='"+(b.index||b.name)+"' id='gs_"+e+"_"+b.name+"' value='"+r+"'/>"),f.prop&&$("input",d).prop(f.prop),void 0!==f.dataInit&&f.dataInit($("input",d)[0]),void 0!==f.dataEvents&&g($("input",d)[0],f.dataEvents),!0===a.autosearch&&(a.searchOnEnter?$("input",
d).keypress(function(a){return 13==(a.charCode?a.charCode:a.keyCode?a.keyCode:0)?(k(),!1):this}):$("input",d).keydown(function(a){switch(a.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:q&&clearTimeout(q),q=setTimeout(function(){k()},500)}}))}"rn"!==b.name&&"checkbox"!==b.formatter&&"select"!==b.formatter&&(d.append($("<span />").attr({"class":" ui-icon  ui-icon-close",id:"search_"+e+"_"+b.name,style:"float:left;top:3px;position: absolute; cursor: pointer;",
title:"\u041d\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f",value:"NONE"})),$("span.ui-icon",d).click(function(){" ui-icon  ui-icon-close"==$(this).prop("class")?$(this).attr({"class":" ui-icon  ui-icon-notice",title:"\u041d\u0435\u0440\u0430\u0432\u043d\u043e",value:"NOT"}):" ui-icon  ui-icon-notice"==$(this).prop("class")?$(this).attr({"class":" ui-icon  ui-icon-carat-1-e",title:"\u0411\u043e\u043b\u044c\u0448\u0435",value:"MORE"}):" ui-icon  ui-icon-carat-1-e"==
$(this).prop("class")?$(this).attr({"class":" ui-icon  ui-icon-carat-1-w",title:"\u041c\u0435\u043d\u044c\u0448\u0435",value:"MINI"}):" ui-icon  ui-icon-carat-1-w"==$(this).prop("class")?$(this).attr({"class":" ui-icon  ui-icon-grip-solid-horizontal",title:"\u0420\u0430\u0432\u043d\u043e",value:"EQUAL"}):" ui-icon  ui-icon-grip-solid-horizontal"==$(this).prop("class")?$(this).attr({"class":" ui-icon  ui-icon-radio-off",title:"\u0432\u0445\u043e\u0434\u0438\u0442",value:"LIKE"}):" ui-icon  ui-icon-radio-off"==
$(this).prop("class")&&$(this).attr({"class":" ui-icon  ui-icon-close",title:"\u041d\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f",value:"NONE"})}));$(h).append(d);$(p).append(h)});$("table thead",c.grid.hDiv).append(p);this.ftoolbar=!0;this.triggerToolbar=k;this.clearToolbar=m;this.toggleToolbar=h;h()}})},setFrozenColumns:function(){return this.each(function(){if(this.grid){var a=this,g=a.p.colModel,c=0,e=g.length,l=-1,k=!1;if(!0!==a.p.subGrid&&!0!==a.p.treeGrid){a.p.rownumbers&&
c++;for(a.p.multiselect&&c++;c<e;){if(!0===g[c].frozen)k=!0,l=c;else break;c++}if(0<=l&&k){a.grid.fhDiv=$('<div style="position:absolute;left:0px;" class="frozen-div ui-state-default ui-jqgrid-hdiv"></div>');a.grid.fbDiv=$('<div style="position:absolute;overflow:hidden;left:0px;" class="frozen-bdiv ui-jqgrid-bdiv"></div>');$("#gview_"+$.jgrid.jqID(a.p.id)).append(a.grid.fhDiv);g=$(".ui-jqgrid-htable","#gview_"+$.jgrid.jqID(a.p.id)).clone(!0);if(a.p.groupHeader){$("tr.jqg-first-row-header, tr.jqg-third-row-header",
g).each(function(){$("th:gt("+l+")",this).remove()});var m=-1,h=-1,p,q;$("tr.jqg-second-row-header th",g).each(function(){p=parseInt($(this).attr("colspan"),10);if(q=parseInt($(this).attr("rowspan"),10))m++,h++;p&&(m+=p,h++);if(m===l)return!1});m!==l&&(h=l);$("tr.jqg-second-row-header",g).each(function(){$("th:gt("+h+")",this).remove()})}else $("tr",g).each(function(){$("th:gt("+l+")",this).remove()});$(g).width(1);$(a.grid.fhDiv).append(g).mousemove(function(b){if(a.grid.resizing)return a.grid.dragMove(b),
!1});$(a).bind("jqGridResizeStop.setFrozenColumns",function(b,c,e){b=$(".ui-jqgrid-htable",a.grid.fhDiv);$("th:eq("+e+")",b).width(c);b=$(".ui-jqgrid-btable",a.grid.fbDiv);$("tr:first td:eq("+e+")",b).width(c);redraw_document($(".ui-tabs-panel[aria-hidden='false']"))});$(a).bind("jqGridSortCol.setFrozenColumns",function(b,c,e){b=$("tr.ui-jqgrid-labels:last th:eq("+a.p.lastsort+")",a.grid.fhDiv);c=$("tr.ui-jqgrid-labels:last th:eq("+e+")",a.grid.fhDiv);$("span.ui-grid-ico-sort",b).addClass("ui-state-disabled");
$(b).attr("aria-selected","false");$("span.ui-icon-"+a.p.sortorder,c).removeClass("ui-state-disabled");$(c).attr("aria-selected","true");a.p.viewsortcols[0]||a.p.lastsort===e||($("span.s-ico",b).hide(),$("span.s-ico",c).show())});$("#gview_"+$.jgrid.jqID(a.p.id)).append(a.grid.fbDiv);$(a.grid.bDiv).scroll(function(){$(a.grid.fbDiv).scrollTop($(this).scrollTop())});!0===a.p.hoverrows&&$("#"+$.jgrid.jqID(a.p.id)).unbind("mouseover").unbind("mouseout");$(a).bind("jqGridAfterGridComplete.setFrozenColumns",
function(){$("#"+$.jgrid.jqID(a.p.id)+"_frozen").remove();$(a.grid.fbDiv).height($(a.grid.bDiv).height()-16);var b=$("#"+$.jgrid.jqID(a.p.id)).clone(!0);$("tr[role=row]",b).each(function(){$("td[role=gridcell]:gt("+l+")",this).remove()});$(b).width(1).attr("id",a.p.id+"_frozen");$(a.grid.fbDiv).append(b);!0===a.p.hoverrows&&($("tr.jqgrow",b).hover(function(){$(this).addClass("ui-state-hover");$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(a.p.id)).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover");
$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(a.p.id)).removeClass("ui-state-hover")}),$("tr.jqgrow","#"+$.jgrid.jqID(a.p.id)).hover(function(){$(this).addClass("ui-state-hover");$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(a.p.id)+"_frozen").addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover");$("#"+$.jgrid.jqID(this.id),"#"+$.jgrid.jqID(a.p.id)+"_frozen").removeClass("ui-state-hover")}));b=null});a.grid.hDiv.loading||$(a).triggerHandler("jqGridAfterGridComplete");a.p.frozenColumns=
!0}}}})}});