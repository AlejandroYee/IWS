/*
 Andrey Lysikov (C) 2014
 Licensed under the MIT license:
   http://www.opensource.org/licenses/mit-license.php
 Part of IWS system
*/
jQuery.uiBackCompat=false;jQuery.jgrid.no_legacy_api=true;var counttab=1;var sumtab=0;var alert_enabled=0;var hidden_menu=false;var user_not_logget=true;var main_menu_higth;var enable_menu=false;var slidebar="left";var doc_height;var doc_width;var doc_title=null;$(function(){redraw_document=function(e){$("body").width(doc_width).height(doc_height);$(".user_login").css({top:doc_height/2-175,left:doc_width/2-200});if($.browser.msie){$(".post_form_login").css("top","110px")}if(typeof e==="undefined")e=$($(".ui-tabs-panel[aria-hidden='false']"));if(e.attr("need_redraw")||e.length===0){$("#tabs").tabs().height(doc_height-main_menu_higth-10);$("#tabs .ui-tabs-panel").height(doc_height-main_menu_higth-10).width(doc_width-20);$(".about_tabs").offset({top:doc_height-50});$(".about_tabs_ver").offset({top:doc_height-25});e.children(".tab_main_content").height(doc_height-main_menu_higth-90).width(doc_width-20);e.attr({need_redraw:false}).children(".navigation_header").height(30)}$(".dialog_jqgrid_overlay").height(doc_height-main_menu_higth-88).width(doc_width-24).offset({top:main_menu_higth+30+50,left:12});e.css("overflow","hidden");if(e.find(".help_content").length>0){var t=e.find(".help_content");var n=e.children(".ui-accordion-header");var r=doc_height-main_menu_higth-150-n.height()*2.05*(n.length-1);t.height(doc_height-main_menu_higth-90).width(doc_width-20);n.width(doc_width-65);t.children(".ui-accordion-content").height(r).width(doc_width-87)}$.each(e.find(".grid_resizer, .grid_resizer_tabs"),function(){var e=$(this);var t=e.attr("form_type");var n=e.attr("percent");if(!e.attr("detail_sub_tab")){if(n<90&&n>10||e.attr("percent_saved")>0){var r=(doc_height-main_menu_higth-93)/100*n}else{var r=doc_height-main_menu_higth-93}doc_width_grid=doc_width-27;add_to_koeff=20}else{n=n-33/(doc_height/100);r=(doc_height-main_menu_higth-93)/100*n-23;doc_width_grid=doc_width-48;add_to_koeff=0}if(t!=="TREE_GRID_FORM_DETAIL"&&t!=="TREE_GRID_FORM"){if(e.children(".ui-jqgrid").find(".ui-search-toolbar").css("display")!=="none"&&t!=="TREE_GRID_FORM_MASTER"){var i=82+add_to_koeff}else{var i=55+add_to_koeff}}else{var i=82}e.height(r).width(doc_width_grid);e.height(r).children(".ui-jqgrid").height(r-2).width(doc_width_grid).children(".ui-jqgrid-pager").height(25).width(doc_width_grid).parent().children(".ui-jqgrid-view").height(r-27).width(doc_width_grid).children(".ui-jqgrid-hdiv").width(doc_width_grid).parent().children(".ui-jqgrid-bdiv").height(r-i).width(doc_width_grid);var s=e.find(".frozen-div");$.each(s,function(){var t=s.children("table").width();var n=e.find(".ui-jqgrid-titlebar").outerHeight();s.width(t).css("top",n+1+"px");s.parent().children(".frozen-bdiv").width(t).height(e.find(".ui-jqgrid-bdiv")[0].clientHeight+1).css("top",n+e.find(".ui-jqgrid-hbox").outerHeight()+1+"px")})});$.each($(".grid_resizer[form_type$='_DETAIL'] div.ui-jqgrid-titlebar, .detail_tab .ui-tabs-nav"),function(){if($(this).children("div[control='window']").length<1){button_htm_down=$("<span>").attr({style:"float:right;cursor: pointer","class":"ui-icon ui-icon-circle-triangle-n",title:"Распахнуть на все окно/восстановить"}).click(function(){upper=$(".ui-tabs-panel[aria-hidden='false'] .grid_resizer:first");downn=$(".ui-tabs-panel[aria-hidden='false'] .grid_resizer:last,.ui-tabs-panel[aria-hidden='false'] .grid_resizer_tabs");$(".ui-tabs-panel[aria-hidden='false'] .ui-icon-circle-triangle-s").show();if(upper.attr("percent_saved")>0){upper.attr("percent",upper.attr("percent_saved")).removeAttr("percent_saved");downn.attr("percent",downn.attr("percent_saved")).removeAttr("percent_saved");downn.show();$(this).parent().remove()}else{upper.attr("percent_saved",upper.attr("percent")).attr("percent",0);downn.attr("percent_saved",downn.attr("percent")).attr("percent",100);upper.hide();$(this).hide()}redraw_document($(".ui-tabs-panel[aria-hidden='false']"))});button_htm_up=$("<span>").attr({style:"float:right;cursor: pointer","class":"ui-icon ui-icon-circle-triangle-s",title:"Свернуть/восстановить"}).click(function(){upper=$(".ui-tabs-panel[aria-hidden='false'] .grid_resizer:first");downn=$(".ui-tabs-panel[aria-hidden='false'] .grid_resizer:last,.ui-tabs-panel[aria-hidden='false'] .grid_resizer_tabs");$(".ui-tabs-panel[aria-hidden='false'] .ui-icon-circle-triangle-n").show();if(upper.attr("percent_saved")>0){upper.attr("percent",upper.attr("percent_saved")).removeAttr("percent_saved");downn.attr("percent",downn.attr("percent_saved")).removeAttr("percent_saved");upper.show();$(this).show()}else{upper.attr("percent_saved",upper.attr("percent")).attr("percent",100);downn.attr("percent_saved",downn.attr("percent")).attr("percent",0);downn.hide();$(this).hide();$(".ui-tabs-panel[aria-hidden='false'] div[control='window']").appendTo(upper.find(".ui-jqgrid-titlebar"))}redraw_document($(".ui-tabs-panel[aria-hidden='false']"))});$(this).append($('<div control="window" style="float:right;"></div>').append(button_htm_up,button_htm_down))}});if(sumtab>7){alert_enabled=1;$.each($(".navigation_header"),function(){if($(this).children(".alert_button").length!==1){$(this).append("<div class='alert_button ui-state-error ui-corner-all' style='float:right;width:100px;margin: 6px 15px 5px 5px;' title='Открыто более 7 вкладок одновременно,"+"это может сильно замедлить работу системы. По возможности закройте одну или несколько вкладок.'><span class='ui-icon ui-icon-alert' style='float:left'></span>ВНИМАНИЕ!</div>")}})}else{if(alert_enabled>0){alert_enabled=0;$(".navigation_header .alert_button").remove()}}};custom_alert=function(e){title_msg="Внимание:";if(e.search("ORA-")!==-1)title_msg="SQL Ошибка конфигурации:";if(e.search("запрещен")!==-1)title_msg="Аунтефикация:";if(!e)e="";$("<div />").html(e).dialog({title:title_msg,resizable:false,minWidth:450,modal:true,dialogClass:"alert",buttons:{"Закрыть":function(){$(this).dialog("close")}},open:function(){$(this).parent().css("z-index",9999).parent().children(".ui-widget-overlay").css("z-index",105)}})};trim_text=function(e,t,n){var r="";if(e.length<t){return e}else{var i=e.split(" ");for(var s=0;s<i.length;s++){r=r+" "+i[s];if(s>n-2){return r+"..."}}}};plot_graph=function(e){$.ajax({url:e.attr("url"),type:"GET",success:function(t){if(t==="Not autorised"){$(location).prop("href",location.href)}var n=jQuery.parseJSON(t);var r=$("#"+e.attr("id"));var i={canvas:true,grid:{hoverable:true,clickable:true},legend:{backgroundOpacity:.8,show:n.legend},xaxis:n.xaxis,yaxes:n.yaxis,zoom:{interactive:true},pan:{interactive:false},crosshair:{mode:"xy"}};$.extend(i,n.options);if(e.children().length===0){$.plot(r,n.data,i);r.bind("plothover",function(e,t,n){var i=r.is(":ui-tooltip");var s=$.ui.tooltip.prototype.options.position;if(n!==null&&i===false){var o=n.series.label,u=n.datapoint[1],a=n.series.data[n.dataIndex][0],f=o+": "+a+", "+u,l;l=$.extend(s,{of:{pageX:n.pageX,pageY:n.pageY,preventDefault:$.noop}});r.tooltip({position:l,content:f,items:"*"}).tooltip("open")}else if(n===null&&i===true){r.tooltip("destroy")}});$("<div><b>"+n.chart_label+"</b></div>").insertBefore(e)}else{$.plot(r,n.data,i)}if(n.xaxis.labelAngle>0){var s=3;e.find(".flot-x-axis").children(".flot-tick-label").css({"-webkit-transform":"translateX(50%) rotate("+n.xaxis.labelAngle+"deg)","-moz-transform":"translateX(50%) rotate("+n.xaxis.labelAngle+"deg)","-ms-transform":"translateX(50%) rotate("+n.xaxis.labelAngle+"deg)","-o-transform":"translateX(50%) rotate("+n.xaxis.labelAngle+"deg)",transform:"translateX(50%) rotate("+n.xaxis.labelAngle+"deg)","transform-origin":s+"px "+s+"px 0px","-ms-transform-origin":s+"px "+s+"px 0px","-moz-transform-origin":s+"px "+s+"px 0px","-webkit-transform-origin":s+"px "+s+"px 0px","-o-transform-origin":s+"px "+s+"px 0px"})}}})};SetTab=function(e,t,n){if(n!=="false"){var r=n;$("."+r).remove();$("#"+r).empty();if(e!==""){$("#ui-"+r).text(trim_text(e,40,3));$("#ui-"+r).prop("title",e)}}else{var r="tabs_"+counttab;sumtab++;$("#tabs").children(".ui-tabs-nav").append($("<li />").css("style","cursor:default;").append($("<a />").css("style","cursor:default;").attr({href:"#"+r,title:e,id:"ui-"+r}).append('<span style="float:right;left:10px;cursor:default;">'+trim_text(e,40,3)+"</span>").append('<span class="ui-icon ui-icon-document" style="float:left;top:5px;cursor:default;"></span>')).append($("<span />").attr({"class":"ui-icon ui-icon-close",style:"float:left;cursor:pointer"}).on("touchend click",function(){CloseTab($(this).parent().attr("aria-controls"))})));$("#tabs").append($("<div />").attr({id:r,style:"overflow:hide;width:"+(doc_width-18)+"px"}))}$("#"+r).append("<div class='loader_tab' style='overflow:hide'><div>");t=t+"&tabid="+r;$("#tabs").tabs("refresh");if(n==="false"){$("#tabs").tabs("option","active",$("#tabs").children(".ui-tabs-nav li").length-1)}$("#"+r).attr({need_redraw:true});$.ajax({url:t,type:"GET",success:function(e){if(e!=="Not autorised"){$.each($("#"+r).find(".ui-jqgrid"),function(){$("#"+$(this).attr("id")).jqGrid("GridDestroy")});$("#"+r).empty().css("text-align","left").attr({need_redraw:true});$("#"+r).append($(e));redraw_document($(".ui-tabs-panel[aria-hidden='false']"))}else{$(location).prop("href",location.href)}}});counttab++};CloseTab=function(e){var t=$("#ui-"+e).parent().closest("li").remove().attr("aria-controls");$("#tabs").tabs("refresh");sumtab--;redraw_document($(".ui-tabs-panel[aria-hidden='false']"));if($(".ui-tabs-nav li[aria-selected='true']").length===0){document.title=doc_title}$("#"+t).remove();$("."+e).remove();if(sumtab===0&&!enable_menu){$(".slidebarmenu").SlidebarMenu("open")}};replace_select_opt_group=function(e){if(typeof e==="undefined")e=$("body");$.each($(e).find("select option[value='GROUP_START']"),function(){$(this).replaceWith("<optgroup label='"+$(this).text()+"' >")});$.each($(e).find("select option[value='GROUP_END']"),function(){var e=$(this).parent();var t=e.children("option:selected");if(typeof e.html()!=="undefined"){var n=$(e.html().split("</optgroup>").join("").split('<option value="GROUP_END"></option>').join("</optgroup>").split('<option role="option" value="GROUP_END"></option>').join("</optgroup>"));n.children('option[value="'+t.attr("value")+'"]').attr("selected","selected");e.empty().append(n)}})};set_resizers=function(){$(".has_resize_control").resizable({distance:30,handles:"s",resize:function(e,t){var n=doc_height-93;var r=100+(t.size.height-n)/Math.abs(n)*100;var i=100-r;if(r>10&&r<95&&i>10&&i<95){var s=$(this).attr("percent",r);switch(s.attr("form_type")){case"GRID_FORM_MASTER":s.parent().children("div[form_type='GRID_FORM_DETAIL']").attr("percent",i);s.parent().children("div[form_type='TABED_GRID_FORM']").attr("percent",i).children(".ui-tabs-panel").children(".grid_resizer_tabs").attr("percent",i);break;case"TREE_GRID_FORM_MASTER":s.parent().children("div[form_type='TREE_GRID_FORM_DETAIL']").attr("percent",i);s.parent().children("div[form_type='TABED_GRID_FORM']").attr("percent",i).children(".ui-tabs-panel").children(".grid_resizer_tabs").attr("percent",i);break;default:s.parent().children("div[form_type='GRID_FORM']").attr("percent",i);s.parent().children("div[form_type='GRID_FORM_RELOAD']").attr("percent",i);break}}},create:function(e,t){$(this).children(".ui-resizable-handle").height(5.3).attr("align","center").append($("<div />").addClass("ui-widget-header ui-state-hover ui-corner-all").height(2).width(150))}})};set_detail_tab=function(){$(".detail_tab").tabs({collapsible:false,heightStyle:"fill",activate:function(e,t){if($("#"+t.newTab.attr("aria-controls")).children(".grid_resizer_tabs").attr("need_update")==="true"){$("#"+$("#"+t.newTab.attr("aria-controls")).children(".grid_resizer_tabs").attr("for")).jqGrid().trigger("reloadGrid",true);$("#"+t.newTab.attr("aria-controls")).children(".grid_resizer_tabs").attr("need_update","false")}redraw_document(t.newPanel)}})};$(document).ready(function(){if($.browser.msie){$(".ui-menu-item a").append("&nbsp;&nbsp;&nbsp;&nbsp;")}doc_height=$(window).height();doc_width=$(window).width()-2;if(!user_not_logget){if(enable_menu){$(".slidebarmenu").menubar({menuIcon:true}).css({"text-align":"left"});main_menu_higth=$(".slidebarmenu").height()}else{main_menu_higth=0;$(".slidebarmenu").SlidebarMenu({onClose:function(){if(sumtab>0){return true}else{return false}},position:slidebar,resizable:true}).SlidebarMenu("open");$("#tabs").children(".ui-tabs-nav").append("<div class='tab-nav-sb sb-toggle' style='float: "+slidebar+";' title='Главное меню'><div class='ui-state-active navicon-line sb-toggle'></div><div class='ui-state-active navicon-line sb-toggle'></div><div class='ui-state-active navicon-line sb-toggle'></div></div>");$(".sb-toggle").click(function(){$(".slidebarmenu").SlidebarMenu("toggle")})}}redraw_document();$(document).tooltip({show:null,items:".btn-box-share",hide:{effect:""}});$("#loading").fadeOut()});$(window).resize(function(){$(".ui-tabs-panel").attr({need_redraw:true});doc_height=$(window).height();doc_width=$(window).width()-2;redraw_document($(".ui-tabs-panel[aria-hidden='false']"));if(!enable_menu){$(".slidebarmenu").SlidebarMenu("resize")}});$("#password").keyup(function(e){if(e.keyCode===13){$("#logon_btn").click()}});$(".iws_param").dialog({autoOpen:false,modal:true,minWidth:450,closeOnEscape:true,resizable:false,buttons:{"Применить":function(){$("#btn_opt_cancel").button("option","disabled",true);$("#btn_opt_save").button("option","disabled",true);var e=[];$.each($(this).find("input, select, textarea"),function(){var t=$(this);if(t.attr("name")!==undefined){if(t.attr("type")==="checkbox"){e[t.attr("name")]=t.attr("checked")==="checked"?"on":"off"}else{e[t.attr("name")]=t.val()}}});e=$.extend({},e);$.ajax({url:location.href+"ajax.saveparams.php",datatype:"json",data:e,cache:false,type:"POST",success:function(e){$(location).prop("href",location.href)}})},"Отмена":function(){$(this).dialog("close")}},close:function(){$(this).dialog("close")},open:function(){$(".ui-dialog-buttonpane").find('button:contains("Отмена")').button({icons:{primary:"ui-icon-close"}}).prop("id","btn_opt_cancel");$(".ui-dialog-buttonpane").find('button:contains("Применить")').button({icons:{primary:"ui-icon-disk"}}).prop("id","btn_opt_save");$(this).parent().css("z-index",805).parent().children(".ui-widget-overlay").css("z-index",800)}});$(".iws_about").dialog({autoOpen:false,modal:true,minWidth:650,closeOnEscape:true,resizable:false,close:function(){$(this).dialog("close")},open:function(){$(this).parent().css("z-index",805).parent().children(".ui-widget-overlay").css("z-index",800)}});$("#themeselector").multiselect({multiple:false,header:false,selectedList:1});$("#editabled,#cache_enable,#slidebar_right").iosCheckbox();$("#random_theme").iosCheckbox({checked:function(){$("#themeselector").multiselect("disable")},unchecked:function(){$("#themeselector").multiselect("enable")}});$("#enable_menu").iosCheckbox({checked:function(){$("#slidebar_right").iosCheckbox("disable")},unchecked:function(){$("#slidebar_right").iosCheckbox("enable")}});$("#renderer").slider({range:"min",value:$("#render_type").val(),min:0,max:3,step:1,slide:function(e,t){if($.browser.msie&&t.value>=2){$("#render_type").val(2);$(this).slider({value:2})}else{$("#render_type").val(t.value)}}}).height(8).children("a").css("border-radius","100%");$("#num_mounth").spinner({spin:function(e,t){if(t.value>6){$(this).spinner("value",1);return false}else if(t.value<1){$(this).spinner("value",6);return false}}});$("#num_reck").spinner({step:10,spin:function(e,t){if(t.value>5e3){$(this).spinner("value",1);return false}else if(t.value<1){$(this).spinner("value",5e3);return false}}});$("#tabs").tabs({collapsible:false,heightStyle:"fill",activate:function(e,t){if(doc_title===null){doc_title=document.title}document.title=doc_title+" [ "+$(t.newTab).children("a").attr("title")+" ]";redraw_document(t.newPanel)}}).find(".ui-tabs-nav").sortable({axis:"x",placeholder:"ui-state-highlight",distance:10,stop:function(){$("#tabs").tabs("refresh");redraw_document($(".ui-tabs-panel[aria-hidden='false']"))}}).disableSelection();$("#logon_btn").button().click(function(e){var t=$("#username").val();var n=$("#password").val();$("#login_form").fadeOut(500);setTimeout(function(){$("#loading_text").text("Загрузка...")},500);setTimeout(function(){if(t.replace(/\s/g,"")===""){custom_alert("Необходимо указать имя пользователя!");$("#loading_text").empty();$("#login_form").fadeIn(500);return false}if(n.replace(/\s/g,"")===""){custom_alert("Необходимо указать пароль!");$("#loading_text").empty();$("#login_form").fadeIn(500);return false}var e="<>()+[]{}:;|'\"~`-=";var r=function(t){for(i=0;i<e.length;i++){if(t.indexOf(e[i])>-1){return true}}return false};if(r(n)===true){custom_alert('Пароль содержит один или несколько символов которые недопустимы для логина в систему. Например символы "&#60;","&#62;" а также некотоые другие специальные символы.');$("#loading_text").empty();$("#login_form").fadeIn(500);return false}$.ajax({url:"ajax.saveparams.php?act=login",datatype:"json",data:{username:$("#username").val(),password:$("#password").val()},cache:false,type:"POST",success:function(e){if(e!="true"){custom_alert("Неверное имя пользователя или пароль!");$("#loading_text").empty();$("#login_form").fadeIn(500)}else{setTimeout(function(){$("#loading").fadeIn(300)},500);setTimeout(function(){$.ajax({success:function(e){$("body").html(e);$("body").children("meta").remove();$("body").children('link[rel!="stylesheet"]').remove();$("body").children("title").remove();$("head").children('style[type="text/css"]').remove();$("head").children('link[rel="stylesheet"]').remove();$("head").children('link[rel="stylesheet"]').remove();$("head").children('script[type="text/javascript"]').remove()}})},1e3)}}})},1e3);return false});$(".help_button").button({icons:{primary:"ui-icon-help"},text:false}).attr("style","float: right;").appendTo("#tabs .ui-tabs-nav").click(function(){SetTab("Индекс справочного раздела",$(this).attr("url"),"false")});$("#tabs").children(".ui-tabs-nav").append($("<button>Закрыть все вкладки</button>").attr({id:"close_all_tab",style:"float: right;margin: 0px 5px 3px 0px;"}).button({icons:{primary:"ui-icon-closethick"},text:false}).click(function(){$.each($("#tabs .ui-tabs-nav li"),function(){CloseTab($(this).attr("aria-controls"))})}));check_form=function(e){var t=true;$.each(e.find("input[is_requred='true']"),function(){if($.trim($(this).val())===""){$(this).addClass("ui-state-error");$("#clone_"+$(this).attr("id")).parent().addClass("ui-state-error");$(this).parent().children(".ui-button").addClass("ui-state-error");t=false}});$.each(e.find("select[is_requred='true']"),function(){if($.trim($(this).val())===""){$(this).addClass("ui-state-error");$(this).parent().children("button").addClass("ui-state-error");t=false}});$.each(e.find("textarea[is_requred='true']"),function(){if($.trim($(this).val())===""){$(this).addClass("ui-state-error");$(this).parent().children(".ace_scroller").addClass("ui-state-error");t=false}});if(t){return true}else{custom_alert("Не все поля заполнены, заполните выделенные ячейки.");return false}};create_from_table_elements=function(e){var t=e.attr("id").split("_");var n=t[t.length-2]+"_"+t[t.length-1];var r=0;$.each(e.find("input, select, textarea"),function(){var t=$(this);t.width(t.attr("w")).addClass(n);switch(t.attr("row_type")){case"I":case"N":case"NL":case"C":sp_value=t.val();t.spinner();if(t.attr("row_type")==="N"){t.spinner("option","culture","ru-RU").spinner("option","numberFormat","n2").spinner("option","step","0.01")}else if(t.attr("row_type")==="NL"){t.spinner("option","culture","ru-RU").spinner("option","numberFormat","n7").spinner("option","step","0.0000001")}else if(t.attr("row_type")==="C"){t.spinner("option","culture","ru-RU").spinner("option","numberFormat","n2").spinner("option","step","0.01")}t.removeClass("ui-widget-content ui-corner-all").calculator({useThemeRoller:true,showAnim:"",showOn:"",onButton:function(e,n,r){t.spinner("value",n)}});$($("<button>Открыть калькулятор</button>").button({icons:{primary:"ui-icon-calculator"},text:false}).click(function(e){t.calculator("show")})).insertAfter(t.parent());if(typeof t.attr("show_disabled")!=="undefined"&&t.attr("show_disabled")!=="false"){t.spinner("option","disabled");t.parent().parent().children(".ui-button").remove()}t.spinner("value",sp_value);break;case"P":t.attr("value","");break;case"B":t.iosCheckbox();break;case"MAS":var i=t.attr("case");t.mask(t.attr("mask"),{onKeyPress:function(e,t,n){switch(i){case"U":$(n).val(e.toUpperCase());break;case"L":$(n).val(e.toLowerCase());break}}});break;case"D":t.datepicker({showOn:"button",showWeek:true,numberOfMonths:num_of_mounth,changeYear:true,firstDay:1}).addClass(n).parent().children(".ui-datepicker-trigger").button({icons:{primary:"ui-icon-calendar"},text:false}).addClass(n);break;case"DT":var s={create:function(e,t,n,r,i,s,o){$('<input class="ui-timepicker-input" value="'+r+'" style="width:50px">').appendTo(t).spinner({min:i,max:s,step:o,change:function(t,n){if(t.originalEvent!==undefined)e._onTimeChange();e._onSelectHandler()},spin:function(r,i){e.control.value(e,t,n,i.value);e._onTimeChange();e._onSelectHandler()}});return t},options:function(e,t,n,r,i){if(typeof r==="string"&&i!==undefined)return t.find(".ui-timepicker-input").spinner(r,i);return t.find(".ui-timepicker-input").spinner(r)},value:function(e,t,n,r){if(r!==undefined)return t.find(".ui-timepicker-input").spinner("value",r);return t.find(".ui-timepicker-input").spinner("value")}};t.datetimepicker({showWeek:true,numberOfMonths:num_of_mounth,changeYear:true,firstDay:1,timeFormat:"HH:mm:ss",showOn:"button",controlType:s}).addClass(n).parent().children(".ui-datepicker-trigger").button({icons:{primary:"ui-icon-calendar"},text:false}).addClass(n);break;case"SB":t.multiselect({multiple:t.attr("multiple")?true:false,minWidth:t.attr("w")<255?255:t.attr("w"),header:true,height_button:29,selectedList:t.attr("size")?t.attr("size"):1}).multiselectfilter().addClass(n);break;case"M":if(t.attr("show_disabled")!=="true"){setTimeout(function(){t.before($("<div />").attr({id:"editor_"+t.attr("name")}));$("#editor_"+t.attr("name")).ace_editor({width:t.attr("w"),heigth:t.attr("rows")*12>50?t.attr("rows")*12:50,mode:"ace/mode/pgsql",classes:"FormElement ui-widget-content ui-corner-all",resizable:true,value:t.val(),change:function(e,n){if(typeof n==="object"){t.val("")}else{t.val(n)}}}).addClass(n).css({"margin-left":"0px;"});t.hide()},50)}break}if(typeof t.attr("field_has_sql")!=="undefined"&&t.attr("row_type")!=="SB"){$($("<button>Расчитать/вставить/обновить содержимое</button>").button({icons:{primary:"ui-icon-refresh"},text:false}).addClass("have_sql_action").click(function(n){var r=[];$.each(e.find("input, select, textarea"),function(){var e=$(this);if(e.attr("name")!==undefined){if(e.attr("row_type")==="B"){r[e.attr("name")]=e.attr("checked")==="checked"?1:0}else{r[e.attr("name")]=e.val()}}});r=$.extend({},r);$.ajax({url:"ajax.data.field.php?type=field&value_name="+t.attr("name")+"&form_id="+t.attr("form_id"),datatype:"json",data:r,cache:false,type:"POST",success:function(n){t.val(n);update_table_elemnts(e,t)}});return false})).insertAfter(e.find("#tr_"+t.attr("id")+" .DataTD").children(":last"));$(this).width($(this).width()+20)}if(typeof t.attr("show_disabled")!=="undefined"&&t.attr("show_disabled")!=="false"){t.attr({name:null,disabled:"disabled"}).addClass("FormElement ui-widget-content ui-corner-all ui-state-disabled");if(typeof t.attr("field_has_sql")!=="undefined"){t.parent().children(".have_sql_action").button("option","disabled",true)}switch(t.attr("row_type")){case"I":case"N":case"NL":case"C":t.spinner({disabled:true});break;case"D":case"DT":t.datepicker("option","disabled",true);t.parent().children(".ui-datepicker-trigger").remove();break;case"SB":t.multiselect("disable");break}}if($(this).width()>r){r=$(this).width()}});return r};hashCode=function(e){return e.split("").reduce(function(e,t){e=(e<<5)-e+t.charCodeAt(0);return e&e},0)};update_table_elemnts=function(e,t){if(typeof t==="undefined"){var n=e.find("input, select, textarea")}else{var n=t}$.each(n,function(){var e=$(this);e.removeClass("ui-state-error");$("#clone_"+e.attr("id")).parent().removeClass("ui-state-error");e.parent().children(".ui-button").removeClass("ui-state-error");e.parent().children("button").removeClass("ui-state-error");e.parent().children(".ace_scroller").removeClass("ui-state-error");switch(e.attr("row_type")){case"I":case"N":case"NL":case"C":e.spinner("value",e.val());break;case"P":e.attr("value","");break;case"B":e.iosCheckbox("refresh");break;case"D":case"DT":strs=e.val();if(strs.length>1){e.datepicker("setDate",e.val())}break;case"SB":if(!e.attr("multiple")){var t=e.find("option:selected").text();e.multiselect("setButtonValue",t);e.multiselect("widget").find("input:checked").removeAttr("checked").removeAttr("aria-selected").parent().removeClass("ui-state-active ui-state-hover");$.each(e.multiselect("widget").find("span:contains('"+t+"')"),function(){if(t!==""&&$(this).text()===t){$(this).parent().addClass("ui-corner-all ui-state-active ui-state-hover").children("input").attr("checked","checked").attr("aria-selected",true)}});if(typeof e.attr("show_disabled")!=="undefined"&&e.attr("show_disabled")!=="false"){e.multiselect("disable");e.multiselect("refresh")}}else{e.multiselect("refresh")}break;case"M":if(e.attr("show_disabled")!=="true"){$("#editor_"+e.attr("name")).ace_editor({value:e.val()})}break}})};get_select_values_grid=function(e,t,n){$.ajax({url:"ajax.data.field.php?type=select&value_name="+t+"&parent_id="+n,datatype:"json",cache:false,type:"GET",success:function(n){$("#"+e).jqGrid("setColProp",t,{editoptions:{value:n},searchoptions:{value:":;"+n}});$("#"+e).attr("new_colmodel",true)}})};$.calculator.regionalOptions["ru"]={decimalChar:".",buttonText:"...",buttonStatus:"Открыть калькулятор",closeText:"Закрыть",closeStatus:"Закрыть калькулятор",useText:"OK",useStatus:"Использовать текущее значение в поле",eraseText:"Сброс",eraseStatus:"Стереть значение",backspaceText:"<-",backspaceStatus:"Стереть последнюю цифру",clearErrorText:"CE",clearErrorStatus:"Стереть последнее число",clearText:"С",clearStatus:"Сбросить",memClearText:"MC",memClearStatus:"Сбросить память",memRecallText:"MR",memRecallStatus:"Вставить из памяти",memStoreText:"MS",memStoreStatus:"Сохранить в память",memAddText:"M+",memAddStatus:"Добавить в память",memSubtractText:"M-",memSubtractStatus:"Вычесть из памяти",base2Text:"Бин",base2Status:"Бинарный",base8Text:"Восм",base8Status:"Восмеричный",base10Text:"Дес",base10Status:"Десятичный",base16Text:"Шест",base16Status:"Шестнадцатиричный",degreesText:"Град",degreesStatus:"Градусы",radiansText:"Рад",radiansStatus:"Радианы",isRTL:false};$.calculator.setDefaults($.calculator.regionalOptions["ru"]);$.extend($.ech.multiselectfilter.prototype.options,{label:"Фильтр:",placeholder:"введите слово"});$.extend($.ech.multiselect.prototype.options,{height:250,minWidth:350,checkAllText:"Отметить все",uncheckAllText:"Снять отметку со всех",noneSelectedText:"Выберите из списка",selectedText:"Выбрано #"});Globalize.addCultureInfo("ru-RU","default",{name:"ru-RU",englishName:"Russian (Russia)",nativeName:"русский (Россия)",language:"ru",numberFormat:{",":"",".":".",negativeInfinity:"-бесконечность",positiveInfinity:"бесконечность",percent:{pattern:["-n%","n%"],",":"",".":"."},currency:{pattern:["-n$","n$"],",":"",".":".",symbol:"p."}},calendars:{standard:{"/":".",firstDay:1,days:{names:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],namesAbbr:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],namesShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},months:{names:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь",""],namesAbbr:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек",""]},monthsGenitive:{names:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря",""],namesAbbr:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек",""]},AM:null,PM:null,patterns:{d:"dd.MM.yyyy",D:"d MMMM yyyy 'г.'",t:"H:mm",T:"H:mm:ss",f:"d MMMM yyyy 'г.' H:mm",F:"d MMMM yyyy 'г.' H:mm:ss",Y:"MMMM yyyy"}}}});$.widget("ui.ace_editor",{options:{editor:null,mode:"ace/mode/pgsql",classes:"ui-widget-content ui-corner-all",resizable:true,value:"",heigth:30,width:250},_create:function(){var e=this,t=e.element.attr("id"),n=$("#"+e.element.attr("id"));e.options.editor=ace.edit(t);e.options.editor.getSession().setMode(e.options.mode);e.options.editor.getSession().setValue(e.options.value);e.options.editor.getSession().on("change",function(){e._trigger("change",e,e.options.editor.getSession().getValue())});e.options.editor.setHighlightActiveLine(false);e.options.editor.renderer.setShowGutter(false);e.options.editor.setShowPrintMargin(false);n.width(e.options.width).height(e.options.heigth).addClass(e.options.classes).css("margin-left","5px");if(e.options.resizable){n.resizable({resize:function(t,r){n.height($(this).height()).width($(this).width());e.options.editor.resize()}})}e.options.editor.resize()},_setOption:function(e,t){$.Widget.prototype._setOption.apply(this,arguments);switch(e){case"value":this.options.editor.getSession().setValue(t);this.options.value=t;break;case"heigth":this.options.heigth=t;break;case"width":this.options.width=t;break;case"resizable":this.options.resizable=t;break;case"classes":this.options.classes=t;break;case"mode":this.options.mode=t;break}}})})